import{g as u,c as r,i as s,S as D,t as m,b as f,a as $,o as Ce}from"./web.CF9Pzi60.js";import{I as U,B as y,a as pe,S as M,b as _}from"./Box.BsvMvqv_.js";import{e as V,a as A,o as S,s as o,b as C,n as h,u as B,l as I,d as j,f as ke,c as xe}from"./_astro_content.N1kaBKOt.js";const W=V(["SATURDAY","SUNDAY"]);A(S({uuid:o(),description:C(o()),title:C(o()),system:o(),master:S({first:o(),last:C(o())}),playerCount:S({min:h(),max:h()}),slot:S({day:W,start:h(),end:h()})}));const Te=V(["INITIALIZED","IN_PROGRESS","CONFIRMED","CONFIRMED_W_INVALID_CHANGES","CONFIRMED_W_VALID_CHANGES","RECONFIRMED"]),Ae=B([S({id:h(),game:o(),self:I(!0),spielerName:j()}),S({id:h(),game:o(),self:I(!1),spielerName:o()})]),Ie=S({registrationId:h(),progress:Te,name:o(),email:o(),handynummer:o(),wantsEmailUpdates:ke(),games:A(Ae),lastSaved:o()});async function Ee(e){const a=new URL("https://elysium.gildedernacht.ch/rst24/load");a.searchParams.append("secret",e);const t=await fetch(a);if(!t.ok)return{kind:"FAILED"};const i=await t.json(),n=Ie.safeParse(i);return n.success?{kind:"SUCCESS",save:n.data}:{kind:"FAILED"}}const De=S({uuid:o(),title:C(o()),system:o(),description:C(o()),playerCount:S({min:h(),max:h()}),master:S({first:o(),last:C(o())}),slot:S({day:W,start:h(),end:h()})}),we=B([S({id:h(),game:o(),self:I(!0),spielerName:j()}),S({id:h(),game:o(),self:I(!1),spielerName:o()})]);async function Ne(){const e=new URL("https://elysium.gildedernacht.ch/rst24/program"),a=new URL("https://elysium.gildedernacht.ch/rst24/reserved"),[t,i]=await Promise.all([fetch(e),fetch(a)]);if(!t.ok)return{kind:"FAILED"};if(!i.ok)return{kind:"FAILED"};const n=await t.json(),d=await i.json(),g=A(De).safeParse(n);if(!g.success)return{kind:"FAILED"};const l=A(we).safeParse(d);return l.success?{kind:"SUCCESS",program:{gameList:g.data,reservedList:l.data}}:{kind:"FAILED"}}function Z(e,a){const i=a.gameList.filter(d=>d.slot.day===e).map(d=>{const g=d.uuid,l=a.reservedList.filter(c=>c.game===g);return{...d,reservedIds:l.map(c=>c.id)}});let n={};for(const d of i){const{start:g}=d.slot,l=n[g]??[];l.push(d),n[g]=l}return Object.entries(n)}var Le=m("<h2>Kontaktdaten"),w=m("<div style=margin-block:.5rem;>"),O=m("<br>");function Re(e){let a;return[u(Le),r(U,{label:"Name",name:"name",get value(){return e.save.name},onValueUpdate:t=>e.updateSave("name",t)}),r(D,{get when(){return e.save.name.trim().length===0},get children(){var t=u(w);return s(t,r(y,{type:"danger",children:"Dies ist ein Pflichtfeld."})),t}}),u(O),r(pe,{label:"E-Mail",name:"email",type:"email",get value(){return e.save.email},onValueUpdate:t=>e.updateSave("email",t),ref(t){var i=a;typeof i=="function"?i(t):a=t}}),r(D,{get when(){return e.save.email.trim().length===0},get children(){var t=u(w);return s(t,r(y,{type:"danger",children:"Dies ist ein Pflichtfeld."})),t}}),r(D,{get when(){return e.save.email.length>0&&a.validity.typeMismatch},get children(){var t=u(w);return s(t,r(y,{type:"danger",children:"Die Eingabe scheint keine gültige E-Mail-Adresse zu sein."})),t}}),u(O),r(U,{label:"Handynummer",name:"tel",type:"tel",get value(){return e.save.handynummer},required:!1,onValueUpdate:t=>e.updateSave("handynummer",t)})]}var Fe=m("<h3 style=margin-block:1rem;>Start <!$><!/> Uhr"),Pe=m("<ul class=event-list role=list>"),Ue=m('<li class="event-entry gray"><h1 class=event-title></h1><div class=event-details><div class=event-tags><strong>Zeit:</strong> <!$><!/> - <!$><!/> Uhr</div><div class=event-tags><strong>Spielleitung:</strong> <!$><!/> <!$><!/></div><div class=event-tags><strong>Spielende:</strong> <!$><!/> - <!$><!/></div></div><!$><!/>'),Oe=m('<div class="event-description content"><p><strong>Beschreibung:</strong><br><!$><!/></p> '),G=m("<h2>Programm Samstag");function K(e){return f(()=>e.programByHour.map(([a,t])=>[(()=>{var i=u(Fe),n=i.firstChild,d=n.nextSibling,[g,l]=$(d.nextSibling);return g.nextSibling,s(i,a,g,l),i})(),(()=>{var i=u(Pe);return s(i,()=>t.map(n=>(()=>{var d=u(Ue),g=d.firstChild,l=g.nextSibling,c=l.firstChild,b=c.firstChild,v=b.nextSibling,p=v.nextSibling,[k,x]=$(p.nextSibling),J=k.nextSibling,Y=J.nextSibling,[N,z]=$(Y.nextSibling);N.nextSibling;var T=c.nextSibling,q=T.firstChild,Q=q.nextSibling,X=Q.nextSibling,[L,ee]=$(X.nextSibling),te=L.nextSibling,ae=te.nextSibling,[ne,re]=$(ae.nextSibling),E=T.nextSibling,ie=E.firstChild,le=ie.nextSibling,se=le.nextSibling,[R,ce]=$(se.nextSibling),ue=R.nextSibling,de=ue.nextSibling,[ge,oe]=$(de.nextSibling),me=l.nextSibling,[Se,he]=$(me.nextSibling);return s(g,()=>n.title===null?n.system:`${n.title} (${n.system})`),s(c,()=>n.slot.start,k,x),s(c,()=>n.slot.end,N,z),s(T,()=>n.master.first,L,ee),s(T,()=>n.master.last,ne,re),s(E,()=>n.playerCount.min,R,ce),s(E,()=>n.playerCount.max,ge,oe),s(d,(()=>{var be=f(()=>n.description!==null&&n.description.trim().length>0);return()=>be()?(()=>{var F=u(Oe),P=F.firstChild,ve=P.firstChild,$e=ve.nextSibling,fe=$e.nextSibling,[_e,ye]=$(fe.nextSibling);return s(P,()=>n.description,_e,ye),F})():null})(),Se,he),d})())),i})()]))}function Ge(e){if(e.program===null)return[u(G),r(y,{children:"Programm wird geladen ..."})];const a=Z("SATURDAY",e.program);return[u(G),r(K,{programByHour:a})]}var H=m("<h2>Programm Sonntag");function He(e){if(e.program===null)return[u(H),r(y,{children:"Programm wird geladen ..."})];const a=Z("SUNDAY",e.program);return[u(H),r(K,{programByHour:a})]}var Me=m("<h2>Zusammenfassung");function Ve(){return u(Me)}var Be=m("<ul role=list style=display:flex;flex-wrap:wrap;column-gap:1rem;row-gap:.5rem;><li></li><li></li><li></li><li>"),je=m("<div style=display:flex;justify-content:space-between;><div></div><div>"),We=m("<div style=display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;><div>Zuletzt gespeichert am <!$><!/></div><!$><!/>"),Ze=m('<div style="padding-block:2rem 1rem;">'),Ke=m("<div style=padding-block:1rem;>");function Je(e){return(()=>{var a=u(Be),t=a.firstChild,i=t.nextSibling,n=i.nextSibling,d=n.nextSibling;return s(t,r(_,{label:"Kontaktdaten",get kind(){return e.activeTab==="Contact"?"special":"gray"},onClick:()=>e.changeTab("Contact")})),s(i,r(_,{label:"Programm Samstag",get kind(){return e.activeTab==="Saturday"?"special":"gray"},onClick:()=>e.changeTab("Saturday")})),s(n,r(_,{label:"Program Sonntag",get kind(){return e.activeTab==="Sunday"?"special":"gray"},onClick:()=>e.changeTab("Sunday")})),s(d,r(_,{label:"Zusammenfassung",get kind(){return e.activeTab==="Summary"?"special":"gray"},onClick:()=>e.changeTab("Summary")})),a})()}function Ye(e){function a(){switch(e.activeTab){case"Saturday":e.changeTab("Contact");break;case"Sunday":e.changeTab("Saturday");break;case"Summary":e.changeTab("Sunday");break}}function t(){switch(e.activeTab){case"Contact":e.changeTab("Saturday");break;case"Saturday":e.changeTab("Sunday");break;case"Sunday":e.changeTab("Summary");break}}return(()=>{var i=u(je),n=i.firstChild,d=n.nextSibling;return s(n,(()=>{var g=f(()=>e.activeTab!=="Contact");return()=>g()?r(_,{label:"<< Vorheriger Schritt",onClick:a}):null})()),s(d,(()=>{var g=f(()=>e.activeTab!=="Summary");return()=>g()?r(_,{label:"Nächster Schritt >>",onClick:t}):null})()),i})()}function ze(e){const a=new Intl.DateTimeFormat("de-CH",{timeStyle:"short",dateStyle:"long"});return console.log(e.lastSaved),r(M,{get children(){var t=u(We),i=t.firstChild,n=i.firstChild,d=n.nextSibling,[g,l]=$(d.nextSibling),c=i.nextSibling,[b,v]=$(c.nextSibling);return s(i,()=>a.format(new Date(e.lastSaved)),g,l),s(t,r(_,{get disabled(){return e.state!=="HAS_CHANGES"},get label(){return e.state==="NO_CHANGES"?"Gespeichert.":e.state==="SAVING"?"Wird gespeichert...":"Speichern"},get onClick(){return e.saveCurrentState}}),b,v),t}})}function qe(e){return[r(Je,{get activeTab(){return e.activeTab},get changeTab(){return e.changeTab}}),(()=>{var a=u(Ke);return s(a,r(M,{get children(){return[f(()=>f(()=>e.activeTab==="Contact")()?r(Re,{get save(){return e.save},get updateSave(){return e.updateSave}}):f(()=>e.activeTab==="Saturday")()?r(Ge,{get program(){return e.program}}):f(()=>e.activeTab==="Sunday")()?r(He,{get program(){return e.program}}):r(Ve,{})),(()=>{var t=u(Ze);return s(t,r(ze,{get lastSaved(){return e.lastSaved},get saveCurrentState(){return e.saveCurrentState},get state(){return e.saveState}})),t})()]}})),a})(),r(Ye,{get activeTab(){return e.activeTab},get changeTab(){return e.changeTab}})]}var Qe=m("<p>Leider ist ein unerwarteter Fehler passiert. Versuche deine Anmeldung erneut zu laden. Wiederholt sich dieser Fehler, bitte kontaktiere uns sobald als möglich über das <a href=/kontatk>Kontaktformular</a>, da dies nicht passieren sollte."),Xe=m("<p>Wir konnten leider keine Anmeldung finden. Wenn du bereits eine Anmeldung begonnen hast, solltest du den korrekten Link per E-Mail erhalten haben.<br><br> Falls du noch keine Anmeldung begonnen hast, kannst du <a href=/anmeldung>hier</a> deine persönliche Anmeldung beginnen. <br><br>Für generelle Fragen oder Probleme, schreibe uns doch bitte über unser <a href=/kontatk>Kontaktformular</a>."),et=m("<code><pre>"),tt=m("<p>Deine Anmeldung wird geladen.");function it(){const[e,a]=xe({state:"LOADING"});function t(){return{state:"ERROR",message:u(Qe)}}function i(l){a(c=>c.state!=="IDLE"&&c.state!=="SAVING"?t():{...c,activeTab:l})}function n(l,c){a(b=>b.state!=="IDLE"&&b.state!=="SAVING"?t():{...b,currentSave:{...b.currentSave,[l]:c},hasChanged:!0})}async function d(){if(e.state!=="IDLE"){a(t());return}a("state","SAVING");const l=new URL("https://elysium.gildedernacht.ch/rst24/save"),c={...e.currentSave};(await fetch(l,{method:"post",body:JSON.stringify(c),headers:{"Content-Type":"application/json"}})).ok?a(v=>{if(v.state!=="SAVING")return t();const p=new Date().toISOString();return{...v,state:"IDLE",hasChanged:!1,lastSaved:p}}):a(t())}function g(){a({state:"ERROR",message:u(Xe)})}return Ce(async()=>{const l=new URL(location.href),c=l.searchParams.get("secret"),b=l.searchParams.get("showCreateMessage")==="true";if(c===null){g();return}const v=await Ee(c),p=Ne();if(v.kind==="FAILED"){g();return}a({state:"IDLE",secret:c,showCreateMessage:b,lastSave:{...v.save},currentSave:v.save,activeTab:"Contact",lastSaved:v.save.lastSaved,hasChanged:!1,program:null}),p.then(k=>{if(k.kind==="FAILED"){g();return}a(x=>x.state!=="IDLE"&&x.state!=="SAVING"?t():{...x,program:k.program})}),l.searchParams.delete("showCreateMessage"),history.replaceState({},document.title,l)}),[f(()=>f(()=>e.state==="ERROR")()?r(y,{type:"danger",get children(){return e.message}}):f(()=>e.state==="LOADING")()?r(y,{get children(){return u(tt)}}):r(qe,{get activeTab(){return e.activeTab},changeTab:i,get save(){return e.currentSave},updateSave:n,get lastSaved(){return e.lastSaved},saveCurrentState:d,get saveState(){return e.state==="SAVING"?"SAVING":e.hasChanged?"HAS_CHANGES":"NO_CHANGES"},get program(){return e.program}})),(()=>{var l=u(et),c=l.firstChild;return s(c,()=>JSON.stringify(e,null,2)),l})()]}export{it as MeineAnmeldung};
