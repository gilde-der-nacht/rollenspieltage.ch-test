import{g as n,c as g,i,S as ae,t as u,a as $,b as z,s as Me,e as Ae,d as Ye,f as Oe,j as xe,r as K,k as m,o as Ve}from"./web.b5oOq_Ze.js";import{I as Ce,B as P,a as ze,S as Te,b as B}from"./Box.B8VoXAoQ.js";import{e as Ee,a as Z,o as T,s as S,b as j,n as E,l as Ue,d as je,u as we,f as Fe,c as We}from"./index.jQjetr37.js";var Ke=u("<h2>Kontaktdaten"),Ze=u("<div class=content><small>Deine persönlichen Daten werden ausschliesslich verwendet, um dich über das Programm der Luzerner Rollenspieltage 2024 zu informieren. Nach dem Event werden diese gelöscht."),Se=u("<br>"),fe=u("<div style=margin-block:.5rem;>");function Je(e){let t;return[n(Ke),n(Ze),n(Se),g(Ce,{label:"Name",name:"name",get value(){return e.save.name},onValueUpdate:a=>e.updateSave("name",a)}),g(ae,{get when(){return e.save.name.trim().length===0},get children(){var a=n(fe);return i(a,g(P,{type:"danger",children:"Dies ist ein Pflichtfeld."})),a}}),n(Se),g(ze,{label:"E-Mail",name:"email",type:"email",get value(){return e.save.email},onValueUpdate:a=>e.updateSave("email",a),ref(a){var r=t;typeof r=="function"?r(a):t=a}}),g(ae,{get when(){return e.save.email.trim().length===0},get children(){var a=n(fe);return i(a,g(P,{type:"danger",children:"Dies ist ein Pflichtfeld."})),a}}),g(ae,{get when(){return e.save.email.length>0&&t.validity.typeMismatch},get children(){var a=n(fe);return i(a,g(P,{type:"danger",children:"Die Eingabe scheint keine gültige E-Mail-Adresse zu sein."})),a}}),n(Se),g(Ce,{label:"Handynummer",name:"tel",type:"tel",get value(){return e.save.handynummer},required:!1,onValueUpdate:a=>e.updateSave("handynummer",a)})]}const Ie=Ee(["SATURDAY","SUNDAY"]);Z(T({uuid:S(),description:j(S()),title:j(S()),system:S(),master:T({first:S(),last:j(S())}),playerCount:T({min:E(),max:E()}),slot:T({day:Ie,start:E(),end:E()})}));const Le=Ee(["INITIALIZED","IN_PROGRESS","CONFIRMED","CONFIRMED_W_INVALID_CHANGES","CONFIRMED_W_VALID_CHANGES","RECONFIRMED"]),Pe=T({game:S(),self:Ue(!0),spielerName:je()}),He=T({game:S(),self:Ue(!1),spielerName:S()}),pe=we([Pe.extend({id:E()}),He.extend({id:E()})]),Xe=we([Pe,He]),qe=T({registrationId:E(),progress:Le,name:S(),email:S(),handynummer:S(),wantsEmailUpdates:Fe(),games:Z(pe),lastSaved:S()});T({registrationId:E(),progress:Le,name:S(),email:S(),handynummer:S(),wantsEmailUpdates:Fe(),games:Z(Xe),lastSaved:S()});async function Qe(e){const t=new URL("https://elysium.gildedernacht.ch/rst24/load");t.searchParams.append("secret",e);const a=await fetch(t);if(!a.ok)return{kind:"FAILED"};const r=await a.json(),d=qe.safeParse(r);return d.success?{kind:"SUCCESS",save:d.data}:{kind:"FAILED"}}const et=T({uuid:S(),title:j(S()),system:S(),description:j(S()),playerCount:T({min:E(),max:E()}),master:T({first:S(),last:j(S())}),slot:T({day:Ie,start:E(),end:E()})}),tt=T({id:E(),gameId:S()});async function nt(){const e=new URL("https://elysium.gildedernacht.ch/rst24/program"),t=new URL("https://elysium.gildedernacht.ch/rst24/reserved"),[a,r]=await Promise.all([fetch(e),fetch(t)]);if(!a.ok)return{kind:"FAILED"};if(!r.ok)return{kind:"FAILED"};const d=await a.json(),l=await r.json(),s=Z(et).safeParse(d);if(!s.success)return{kind:"FAILED"};const v=Z(tt).safeParse(l);return v.success?{kind:"SUCCESS",program:{gameList:s.data,reservedList:v.data}}:{kind:"FAILED"}}function Ge(e,t){const r=t.gameList.filter(l=>l.slot.day===e).map(l=>{const s=l.uuid,v=t.reservedList.filter(k=>k.gameId===s);return{...l,reservedIds:v.map(k=>k.id)}});let d={};for(const l of r){const{start:s}=l.slot,v=d[s]??[];v.push(l),d[s]=v}return Object.entries(d)}var at=u("<label class=input-checkbox><input type=checkbox><!$><!/>");function rt(e){return(()=>{var t=n(at),a=t.firstChild,r=a.nextSibling,[d,l]=$(r.nextSibling);return a.addEventListener("change",s=>e.onValueUpdate(s.target.checked)),i(t,()=>e.label,d,l),z(()=>Me(a,"name",e.name)),z(()=>Ae(a,"value",e.value)),z(()=>Ae(a,"checked",e.checked)),t})()}var it=u("<li><h1 class=event-title></h1><div class=event-details><div class=event-tags><strong>Zeit:</strong> <!$><!/> - <!$><!/> Uhr</div><div class=event-tags><strong>Spielleitung:</strong> <!$><!/> <!$><!/></div><div class=event-tags><strong>Freie Plätze:</strong> <!$><!/></div></div><div class=event-description><!$><!/><!$><!/></div><!$><!/>"),lt=u("<span>Es hat noch <strong><!$><!/> Plätze</strong> frei."),st=u("<span>Es hat noch <strong><!$><!/> Platz</strong> frei."),dt=u('<div class="event-description content"><p><strong>Beschreibung:</strong><br><!$><!/>'),ut=u("<div><p><strong>Deine Reservationen</strong></p><ul>"),gt=u("<li style=font-size:0.83rem;>"),ot=u("<s>"),De=u('<span title="ungespeicherte Änderung"> *'),mt=u('<a href=javascript:; style=border:none; title="Reservation löschen"><i class="fa-duotone fa-circle-xmark">'),ct=u("<ul role=list class=event-links><li><a class=event-link href=javascript:;>+ Platz für mich reservieren"),vt=u("<ul role=list class=event-links><li><a class=event-link href=javascript:;>+ Platz für Begleitung reservieren"),$t=u("<div class=content><small>Auf dieser Seite kannst du dich und deine Freunde für Spielrunden einschreiben, solange es freie Plätze hat."),Ne=u("<br>"),_t=u("<div class=event-filters><h2>Filter</h2><ul role=list><li><a href=javascript:;>Alle</a></li><!$><!/>"),ht=u("<li><a href=javascript:;><!$><!/> Uhr"),St=u("<h3 style=margin-block:1rem;>Start <!$><!/> Uhr"),ft=u("<ul class=event-list role=list>");const bt=1;function yt(e){function t(){return[...e.confirmedReservations.map(r=>({name:r.spielerName??e.selfName,confirmed:!0,gameUuid:e.entry.uuid,reservationId:r.id,markedForDeletion:e.markedForDeletionReservations.includes(r.id)})),...e.tentativeReservations.map(r=>({name:r.friendsName??e.selfName,confirmed:!1,gameUuid:e.entry.uuid,markedForDeletion:!1}))]}function a(){const r=e.confirmedReservations.map(l=>l.id),d=e.entry.reservedIds.filter(l=>!r.includes(l));return e.entry.playerCount.max-bt-d.length-t().filter(l=>!l.markedForDeletion).length}return(()=>{var r=n(it),d=r.firstChild,l=d.nextSibling,s=l.firstChild,v=s.firstChild,k=v.nextSibling,c=k.nextSibling,[o,h]=$(c.nextSibling),b=o.nextSibling,U=b.nextSibling,[y,w]=$(U.nextSibling);y.nextSibling;var F=s.nextSibling,L=F.firstChild,M=L.nextSibling,W=M.nextSibling,[J,re]=$(W.nextSibling),ie=J.nextSibling,p=ie.nextSibling,[le,se]=$(p.nextSibling),X=F.nextSibling,de=X.firstChild,ue=de.nextSibling,ge=ue.nextSibling,[oe,me]=$(ge.nextSibling),G=l.nextSibling,ce=G.firstChild,[q,Q]=$(ce.nextSibling),ve=q.nextSibling,[$e,ee]=$(ve.nextSibling),_e=G.nextSibling,[he,te]=$(_e.nextSibling);return i(d,()=>e.entry.title===null?e.entry.system:`${e.entry.title} (${e.entry.system})`),i(s,()=>e.entry.slot.start,o,h),i(s,()=>e.entry.slot.end,y,w),i(F,()=>e.entry.master.first,J,re),i(F,()=>e.entry.master.last,le,se),i(X,(()=>{var I=m(()=>a()>1);return()=>I()?(()=>{var D=n(lt),A=D.firstChild,N=A.nextSibling,x=N.firstChild,[f,_]=$(x.nextSibling);return f.nextSibling,i(N,a,f,_),D})():(()=>{var D=m(()=>a()===1);return()=>D()?(()=>{var A=n(st),N=A.firstChild,x=N.nextSibling,f=x.firstChild,[_,R]=$(f.nextSibling);return _.nextSibling,i(x,a,_,R),A})():"Diese Spielrunde ist bereits voll besetzt."})()})(),oe,me),i(G,(()=>{var I=m(()=>e.entry.description!==null&&e.entry.description.trim().length>0);return()=>I()?(()=>{var D=n(dt),A=D.firstChild,N=A.firstChild,x=N.nextSibling,f=x.nextSibling,[_,R]=$(f.nextSibling);return i(A,()=>e.entry.description,_,R),D})():null})(),q,Q),i(G,(()=>{var I=m(()=>t().length>0);return()=>I()?(()=>{var D=n(ut),A=D.firstChild,N=A.nextSibling;return i(N,()=>t().map(x=>(()=>{var f=n(gt);return i(f,(()=>{var _=m(()=>!!x.markedForDeletion);return()=>_()?[(()=>{var R=n(ot);return i(R,()=>x.name),R})(),n(De)]:[m(()=>x.name),m(()=>m(()=>!!x.confirmed)()?null:n(De)),(()=>{var R=n(mt);return R.$$click=()=>e.deleteReservation(x),K(),R})()]})()),f})())),D})():null})(),$e,ee),i(r,(()=>{var I=m(()=>a()>0);return()=>I()?(()=>{var D=m(()=>t().length===0);return()=>D()?(()=>{var A=n(ct),N=A.firstChild,x=N.firstChild;return x.$$click=()=>e.addTentativeReservation({gameUuid:e.entry.uuid,friendsName:null}),K(),A})():(()=>{var A=n(vt),N=A.firstChild,x=N.firstChild;return x.$$click=()=>{const f=prompt("Bitte teile uns mit, wie deine Begleitung heisst:");f!==null&&f.trim().length>0&&e.addTentativeReservation({gameUuid:e.entry.uuid,friendsName:f})},K(),A})()})():null})(),he,te),z(()=>xe(r,`event-entry ${t().filter(I=>!I.markedForDeletion).length>0?"success":a()>0?"special":"gray"}`)),r})()}const ne="ALL";function Be(e){const[t,a]=Oe(ne);return[n($t),n(Ne),g(rt,{get checked(){return e.wantsEmailUpdates},onValueUpdate:r=>e.updateSave("wantsEmailUpdates",r),label:"Ja, ich möchte gerne Updates erhalten, wenn neue Spielrunden aufgeschalten werden.",name:"wantsUpdates",value:"true"}),n(Ne),(()=>{var r=n(_t),d=r.firstChild,l=d.nextSibling,s=l.firstChild,v=s.firstChild,k=s.nextSibling,[c,o]=$(k.nextSibling);return v.$$click=()=>a(ne),i(l,()=>e.programByHour.map(([h,b])=>(()=>{var U=n(ht),y=U.firstChild,w=y.firstChild,[F,L]=$(w.nextSibling);return F.nextSibling,y.$$click=()=>a(h),i(y,h,F,L),z(()=>xe(y,t()===h?"active":"")),K(),U})()),c,o),z(()=>xe(v,t()===ne?"active":"")),K(),r})(),m(()=>e.programByHour.filter(([r])=>r===t()||ne===t()).map(([r,d])=>[(()=>{var l=n(St),s=l.firstChild,v=s.nextSibling,[k,c]=$(v.nextSibling);return k.nextSibling,i(l,r,k,c),l})(),(()=>{var l=n(ft);return i(l,()=>d.map(s=>g(yt,{entry:s,get selfName(){return e.selfName},get confirmedReservations(){return e.confirmedReservations.filter(v=>v.game===s.uuid)},get tentativeReservations(){return e.tentativeReservations.filter(v=>v.gameUuid===s.uuid)},get markedForDeletionReservations(){return e.markedForDeletionReservations},get addTentativeReservation(){return e.addTentativeReservation},get deleteReservation(){return e.deleteReservation}}))),l})()]))]}Ye(["click"]);function Rt(e){const t=Ge("SATURDAY",e.program);return g(Be,{get selfName(){return e.selfName},programByHour:t,get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get markedForDeletionReservations(){return e.markedForDeletionReservations},get wantsEmailUpdates(){return e.wantsEmailUpdates},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave},get deleteReservation(){return e.deleteReservation}})}function kt(e){const t=Ge("SUNDAY",e.program);return g(Be,{get selfName(){return e.selfName},programByHour:t,get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get markedForDeletionReservations(){return e.markedForDeletionReservations},get wantsEmailUpdates(){return e.wantsEmailUpdates},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave},get deleteReservation(){return e.deleteReservation}})}var xt=u("<p><strong><!$><!/> </strong>| <!$><!/>, <!$><!/> bis <!$><!/> Uhr"),At=u("<p>Reservation für <strong>"),Ct=u("<div class=content><h2>Zusammenfassung</h2><small>Hier hast du die komplette Übersicht über alle deine Eingaben. Du kannst bis zum XX (TODO) zurückkommen und deine Kontaktdaten und Reservationen anpassen.</small><h3>Kontaktdaten</h3><ul><li><strong>Name:</strong> <!$><!/></li><li><strong>E-Mail:</strong> <!$><!/></li><li><strong>Handynummer:</strong> <!$><!/></li></ul><br><h3>Deine Reservationen</h3><!$><!/><!$><!/><!$><!/><!$><!/><br><h3>Updates</h3><p><em>"),Dt=u("<p><em>Noch keine Reservationen getätigt."),Nt=u("<h4>Unbestätigt"),Tt=u("<p>Bitte speichere deinen aktuellen Stand der Anmeldung, damit wir die folgenden Reservationen bestätigen können."),be=u("<h5>Samstag, 24. August 2024"),Y=u("<ul role=list style=display:grid;gap:.5rem;>"),O=u("<li>"),ye=u("<h5>Sonntag, 25. August 2024"),Et=u("<h4>Reservationen, die du entfernen möchtest"),Ut=u("<p>Bitte speichere deinen aktuellen Stand der Anmeldung, damit wir die folgenden Reservationen entfernen können."),wt=u("<h4>Bestätigt"),Ft=u("<span style=color:var(--clr-success-10);>Ja, ich möchte gerne Updates erhalten, wenn neue Spielrunden aufgeschalten werden."),It=u("<span style=color:var(--clr-danger-10);>Nein, ich möchte keine E-Mails über neue Spielrunden erhalten.");function V(e){const{game:t,reservation:a}=e.reservation;return g(P,{get type(){return e.type??"gray"},get children(){return[(()=>{var r=n(xt),d=r.firstChild,l=d.firstChild,[s,v]=$(l.nextSibling);s.nextSibling;var k=d.nextSibling,c=k.nextSibling,[o,h]=$(c.nextSibling),b=o.nextSibling,U=b.nextSibling,[y,w]=$(U.nextSibling),F=y.nextSibling,L=F.nextSibling,[M,W]=$(L.nextSibling);return M.nextSibling,i(d,()=>t.title===null?t.system:`${t.title} (${t.system})`,s,v),i(r,()=>t.slot.day==="SATURDAY"?"Samstag":"Sonntag",o,h),i(r,()=>t.slot.start,y,w),i(r,()=>t.slot.end,M,W),r})(),(()=>{var r=n(At),d=r.firstChild,l=d.nextSibling;return i(l,()=>a.friendsName===null?e.selfName:a.friendsName),r})()]}})}function Re(e,t){const a=[],r=[];for(const d of e){const l=t?.gameList.find(s=>s.uuid===d.gameUuid);l?.slot.day==="SATURDAY"&&a.push({reservation:d,game:l}),l?.slot.day==="SUNDAY"&&r.push({reservation:d,game:l})}return{SATURDAY:a.toSorted((d,l)=>d.game.slot.start<l.game.slot.start?-1:1),SUNDAY:r.toSorted((d,l)=>d.game.slot.start<l.game.slot.start?-1:1)}}function Lt(e){const{con:t,del:a}=e.save.games.reduce((s,v)=>e.markedForDeletionReservations.includes(v.id)?{...s,del:[...s.del,v]}:{...s,con:[...s.con,v]},{con:[],del:[]}),r=Re(t.map(s=>({gameUuid:s.game,friendsName:s.spielerName})),e.program),d=Re(a.map(s=>({gameUuid:s.game,friendsName:s.spielerName})),e.program),l=Re(e.tentativeReservations,e.program);return(()=>{var s=n(Ct),v=s.firstChild,k=v.nextSibling,c=k.nextSibling,o=c.nextSibling,h=o.firstChild,b=h.firstChild,U=b.nextSibling,y=U.nextSibling,[w,F]=$(y.nextSibling),L=h.nextSibling,M=L.firstChild,W=M.nextSibling,J=W.nextSibling,[re,ie]=$(J.nextSibling),p=L.nextSibling,le=p.firstChild,se=le.nextSibling,X=se.nextSibling,[de,ue]=$(X.nextSibling),ge=o.nextSibling,oe=ge.nextSibling,me=oe.nextSibling,[G,ce]=$(me.nextSibling),q=G.nextSibling,[Q,ve]=$(q.nextSibling),$e=Q.nextSibling,[ee,_e]=$($e.nextSibling),he=ee.nextSibling,[te,I]=$(he.nextSibling),D=te.nextSibling,A=D.nextSibling,N=A.nextSibling,x=N.firstChild;return i(h,()=>e.save.name,w,F),i(L,()=>e.save.email,re,ie),i(p,()=>e.save.handynummer,de,ue),i(s,(()=>{var f=m(()=>e.save.games.length===0&&e.tentativeReservations.length===0);return()=>f()?n(Dt):null})(),G,ce),i(s,(()=>{var f=m(()=>e.tentativeReservations.length>0);return()=>f()?[n(Nt),n(Tt),m(()=>m(()=>l.SATURDAY.length>0)()?[n(be),(()=>{var _=n(Y);return i(_,()=>l.SATURDAY.map(R=>(()=>{var C=n(O);return i(C,g(V,{reservation:R,get selfName(){return e.save.name},type:"special"})),C})())),_})()]:null),m(()=>m(()=>l.SUNDAY.length>0)()?[n(ye),(()=>{var _=n(Y);return i(_,()=>l.SUNDAY.map(R=>(()=>{var C=n(O);return i(C,g(V,{reservation:R,get selfName(){return e.save.name},type:"special"})),C})())),_})()]:null)]:null})(),Q,ve),i(s,(()=>{var f=m(()=>a.length>0);return()=>f()?[n(Et),n(Ut),m(()=>m(()=>d.SATURDAY.length>0)()?[n(be),(()=>{var _=n(Y);return i(_,()=>d.SATURDAY.map(R=>(()=>{var C=n(O);return i(C,g(V,{reservation:R,get selfName(){return e.save.name},type:"danger"})),C})())),_})()]:null),m(()=>m(()=>d.SUNDAY.length>0)()?[n(ye),(()=>{var _=n(Y);return i(_,()=>d.SUNDAY.map(R=>(()=>{var C=n(O);return i(C,g(V,{reservation:R,get selfName(){return e.save.name},type:"danger"})),C})())),_})()]:null)]:null})(),ee,_e),i(s,(()=>{var f=m(()=>t.length>0);return()=>f()?[n(wt),m(()=>m(()=>r.SATURDAY.length>0)()?[n(be),(()=>{var _=n(Y);return i(_,()=>r.SATURDAY.map(R=>(()=>{var C=n(O);return i(C,g(V,{reservation:R,get selfName(){return e.save.name},type:"success"})),C})())),_})()]:null),m(()=>m(()=>r.SUNDAY.length>0)()?[n(ye),(()=>{var _=n(Y);return i(_,()=>r.SUNDAY.map(R=>(()=>{var C=n(O);return i(C,g(V,{reservation:R,get selfName(){return e.save.name},type:"success"})),C})())),_})()]:null)]:null})(),te,I),i(x,(()=>{var f=m(()=>!!e.save.wantsEmailUpdates);return()=>f()?n(Ft):n(It)})()),s})()}var Pt=u("<ul role=list style=display:flex;flex-wrap:wrap;column-gap:1rem;row-gap:.5rem;><li></li><li></li><li></li><li>"),Ht=u("<div style=display:flex;justify-content:space-between;><div></div><div>"),Gt=u("<div style=display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;gap:1rem;><div>Zuletzt gespeichert am <!$><!/></div><div style=display:flex;flex-wrap:wrap;gap:1rem;align-items:center;margin-left:auto;><p><em><small></small></em></p><!$><!/>"),Bt=u('<div style="padding-block:2rem 1rem;position:sticky;bottom:0;background-image:linear-gradient(transparent, var(--clr-3) 25%);">'),Mt=u("<div style=padding-block:1rem;>"),Yt=u("<h2>Programm Samstag"),Ot=u("<h2>Programm Sonntag");function Vt(e){return(()=>{var t=n(Pt),a=t.firstChild,r=a.nextSibling,d=r.nextSibling,l=d.nextSibling;return i(a,g(B,{label:"Kontaktdaten",get kind(){return e.activeTab==="Contact"?"special":"gray"},onClick:()=>e.changeTab("Contact")})),i(r,g(B,{label:"Programm Samstag",get kind(){return e.activeTab==="Saturday"?"special":"gray"},onClick:()=>e.changeTab("Saturday")})),i(d,g(B,{label:"Program Sonntag",get kind(){return e.activeTab==="Sunday"?"special":"gray"},onClick:()=>e.changeTab("Sunday")})),i(l,g(B,{label:"Zusammenfassung",get kind(){return e.activeTab==="Summary"?"special":"gray"},onClick:()=>e.changeTab("Summary")})),t})()}function zt(e){function t(){switch(e.activeTab){case"Saturday":e.changeTab("Contact");break;case"Sunday":e.changeTab("Saturday");break;case"Summary":e.changeTab("Sunday");break}}function a(){switch(e.activeTab){case"Contact":e.changeTab("Saturday");break;case"Saturday":e.changeTab("Sunday");break;case"Sunday":e.changeTab("Summary");break}}return(()=>{var r=n(Ht),d=r.firstChild,l=d.nextSibling;return i(d,(()=>{var s=m(()=>e.activeTab!=="Contact");return()=>s()?g(B,{label:"<< Vorheriger Schritt",onClick:t}):null})()),i(l,(()=>{var s=m(()=>e.activeTab!=="Summary");return()=>s()?g(B,{label:"Nächster Schritt >>",onClick:a}):null})()),r})()}function jt(e){const t=new Intl.DateTimeFormat("de-CH",{timeStyle:"short",dateStyle:"long"});return g(Te,{get type(){return e.state==="HAS_CHANGES"?"success":"gray"},get children(){var a=n(Gt),r=a.firstChild,d=r.firstChild,l=d.nextSibling,[s,v]=$(l.nextSibling),k=r.nextSibling,c=k.firstChild,o=c.firstChild,h=o.firstChild,b=c.nextSibling,[U,y]=$(b.nextSibling);return i(r,()=>t.format(new Date(e.lastSaved)),s,v),i(h,()=>e.state==="NO_CHANGES"?"keine Änderungen entdeckt":e.state==="HAS_CHANGES"?"ungespeicherte Änderungen entdeckt":""),i(k,g(B,{get disabled(){return e.state!=="HAS_CHANGES"},get label(){return e.state==="NO_CHANGES"?"Gespeichert.":e.state==="SAVING"?"Wird gespeichert...":"Speichern"},get kind(){return e.state==="HAS_CHANGES"?"success":"gray"},get onClick(){return e.saveCurrentState}}),U,y),a}})}function Wt(e){return[g(Vt,{get activeTab(){return e.activeTab},get changeTab(){return e.changeTab}}),(()=>{var t=n(Mt);return i(t,g(Te,{get children(){return[m(()=>m(()=>e.activeTab==="Contact")()?g(Je,{get save(){return e.save},get updateSave(){return e.updateSave}}):m(()=>e.activeTab==="Saturday")()?[n(Yt),m(()=>m(()=>e.program===null)()?g(P,{children:"Programm wird geladen ..."}):g(Rt,{get selfName(){return e.save.name},get program(){return e.program},get wantsEmailUpdates(){return e.save.wantsEmailUpdates},get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get markedForDeletionReservations(){return e.markedForDeletionReservations},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave},get deleteReservation(){return e.deleteReservation}}))]:m(()=>e.activeTab==="Sunday")()?[n(Ot),m(()=>m(()=>e.program===null)()?g(P,{children:"Programm wird geladen ..."}):g(kt,{get selfName(){return e.save.name},get program(){return e.program},get wantsEmailUpdates(){return e.save.wantsEmailUpdates},get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get markedForDeletionReservations(){return e.markedForDeletionReservations},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave},get deleteReservation(){return e.deleteReservation}}))]:g(Lt,{get save(){return e.save},get tentativeReservations(){return e.tentativeReservations},get program(){return e.program},get markedForDeletionReservations(){return e.markedForDeletionReservations}})),(()=>{var a=n(Bt);return i(a,g(jt,{get lastSaved(){return e.lastSaved},get saveCurrentState(){return e.saveCurrentState},get state(){return e.saveState}})),a})()]}})),t})(),g(zt,{get activeTab(){return e.activeTab},get changeTab(){return e.changeTab}})]}var Kt=u("<p>Leider ist ein unerwarteter Fehler passiert. Versuche deine Anmeldung erneut zu laden. Wiederholt sich dieser Fehler, bitte kontaktiere uns sobald als möglich über das <a href=/kontakt>Kontaktformular</a>, da dies nicht passieren sollte."),Zt=u("<p>Wir konnten leider keine Anmeldung finden. Wenn du bereits eine Anmeldung begonnen hast, solltest du den korrekten Link per E-Mail erhalten haben.<br><br> Falls du noch keine Anmeldung begonnen hast, kannst du <a href=/anmeldung>hier</a> deine persönliche Anmeldung beginnen. <br><br>Für generelle Fragen oder Probleme, schreibe uns doch bitte über unser <a href=/kontatk>Kontaktformular</a>.");function H(){return{state:"ERROR",message:n(Kt)}}function Jt(){const[e,t]=We({state:"LOADING"});function a(){t({state:"ERROR",message:n(Zt)})}async function r(){const c=new URL(location.href),o=c.searchParams.get("secret"),h=c.searchParams.get("showCreateMessage")==="true";if(o===null){a();return}const b=await Qe(o),U=nt();if(b.kind==="FAILED"){a();return}t(y=>y.state==="SAVING"?{state:"IDLE",secret:o,showCreateMessage:h,currentSave:b.save,activeTab:y.activeTab,lastSaved:b.save.lastSaved,hasChanged:!1,program:y.program,tentativeReservations:[],markedForDeletionReservations:[]}:{state:"IDLE",secret:o,showCreateMessage:h,currentSave:b.save,activeTab:"Contact",lastSaved:b.save.lastSaved,hasChanged:!1,program:null,tentativeReservations:[],markedForDeletionReservations:[]}),U.then(y=>{if(y.kind==="FAILED"){a();return}t(w=>w.state!=="IDLE"&&w.state!=="SAVING"?H():{...w,program:y.program})}),c.searchParams.delete("showCreateMessage"),history.replaceState({},document.title,c),window.scrollTo({top:0})}function d(c){t(o=>o.state!=="IDLE"&&o.state!=="SAVING"?H():{...o,activeTab:c}),window.scrollTo({top:0})}function l(c,o){t(h=>h.state!=="IDLE"&&h.state!=="SAVING"?H():{...h,currentSave:{...h.currentSave,[c]:o},hasChanged:!0})}async function s(){if(e.state!=="IDLE"){t(H());return}t("state","SAVING");const c=new URL("https://elysium.gildedernacht.ch/rst24/save"),o={...e.currentSave,games:[...e.currentSave.games.filter(b=>!e.markedForDeletionReservations.includes(b.id)),...e.tentativeReservations.map(b=>b.friendsName===null?{game:b.gameUuid,self:!0,spielerName:null}:{game:b.gameUuid,self:!1,spielerName:b.friendsName})]};(await fetch(c,{method:"post",body:JSON.stringify(o),headers:{"Content-Type":"application/json"}})).ok?await r():t(H())}function v(c){t(o=>o.state!=="IDLE"&&o.state!=="SAVING"?H():{...o,hasChanged:!0,tentativeReservations:[...o.tentativeReservations,c]})}function k(c){c.confirmed?t(o=>o.state!=="IDLE"&&o.state!=="SAVING"?H():{...o,hasChanged:!0,markedForDeletionReservations:[...o.markedForDeletionReservations,c.reservationId]}):t(o=>o.state!=="IDLE"&&o.state!=="SAVING"?H():{...o,tentativeReservations:o.tentativeReservations.filter(h=>h.gameUuid!==c.gameUuid?!0:h.friendsName===c.name?!1:c.name!==o.currentSave.name)})}return{store:e,actions:{changeTab:d,updateSave:l,saveCurrentState:s,onFailed:a,initMeineAnmeldung:r,addTentativeReservation:v,deleteReservation:k}}}var pt=u("<p>Deine Anmeldung wird geladen."),ke=u("<br>");function en(){const{store:e,actions:t}=Jt();return Ve(async()=>{await t.initMeineAnmeldung()}),m(()=>m(()=>e.state==="ERROR")()?g(P,{type:"danger",get children(){return e.message}}):m(()=>e.state==="LOADING")()?g(P,{get children(){return n(pt)}}):[g(ae,{get when(){return e.showCreateMessage},get children(){return[g(P,{type:"success",get children(){return["Deine Anmeldung wurde erfolgreich gestartet.",n(ke),n(ke),"Wir haben eine E-Mail an deine Adresse gesendet. In dieser E-Mail findest du einen persönlichen Link, um deine Anmeldung bis kurz vor dem Anlass anzupassen."]}}),n(ke)]}}),g(Wt,{get activeTab(){return e.activeTab},get changeTab(){return t.changeTab},get save(){return e.currentSave},get updateSave(){return t.updateSave},get lastSaved(){return e.lastSaved},get saveCurrentState(){return t.saveCurrentState},get saveState(){return e.state==="SAVING"?"SAVING":e.hasChanged?"HAS_CHANGES":"NO_CHANGES"},get program(){return e.program},get confirmedReservations(){return e.currentSave.games},get tentativeReservations(){return e.tentativeReservations},get addTentativeReservation(){return t.addTentativeReservation},get deleteReservation(){return t.deleteReservation},get markedForDeletionReservations(){return e.markedForDeletionReservations}})])}export{en as MeineAnmeldung};
