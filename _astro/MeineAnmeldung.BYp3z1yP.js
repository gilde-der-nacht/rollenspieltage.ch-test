import{g as i,c as g,i as l,S as ee,t as d,a as v,b as O,s as Be,d as ye,e as Oe,f as Ve,h as fe,r as be,j as _,o as Ye}from"./web.DDKVi3E9.js";import{I as xe,B as I,a as je,S as we,b as p}from"./Box.iyaGn6e6.js";import{e as Ue,a as Y,o as R,s as h,b as V,n as C,l as De,d as ze,u as Ie,f as Le,c as We}from"./index.CxgbH3Vf.js";var Je=d("<h2>Kontaktdaten"),_e=d("<div style=margin-block:.5rem;>"),Re=d("<br>");function Ke(e){let t;return[i(Je),g(xe,{label:"Name",name:"name",get value(){return e.save.name},onValueUpdate:n=>e.updateSave("name",n)}),g(ee,{get when(){return e.save.name.trim().length===0},get children(){var n=i(_e);return l(n,g(I,{type:"danger",children:"Dies ist ein Pflichtfeld."})),n}}),i(Re),g(je,{label:"E-Mail",name:"email",type:"email",get value(){return e.save.email},onValueUpdate:n=>e.updateSave("email",n),ref(n){var a=t;typeof a=="function"?a(n):t=n}}),g(ee,{get when(){return e.save.email.trim().length===0},get children(){var n=i(_e);return l(n,g(I,{type:"danger",children:"Dies ist ein Pflichtfeld."})),n}}),g(ee,{get when(){return e.save.email.length>0&&t.validity.typeMismatch},get children(){var n=i(_e);return l(n,g(I,{type:"danger",children:"Die Eingabe scheint keine gültige E-Mail-Adresse zu sein."})),n}}),i(Re),g(xe,{label:"Handynummer",name:"tel",type:"tel",get value(){return e.save.handynummer},required:!1,onValueUpdate:n=>e.updateSave("handynummer",n)})]}const Fe=Ue(["SATURDAY","SUNDAY"]);Y(R({uuid:h(),description:V(h()),title:V(h()),system:h(),master:R({first:h(),last:V(h())}),playerCount:R({min:C(),max:C()}),slot:R({day:Fe,start:C(),end:C()})}));const Pe=Ue(["INITIALIZED","IN_PROGRESS","CONFIRMED","CONFIRMED_W_INVALID_CHANGES","CONFIRMED_W_VALID_CHANGES","RECONFIRMED"]),He=R({game:h(),self:De(!0),spielerName:ze()}),Ge=R({game:h(),self:De(!1),spielerName:h()}),Ze=Ie([He.extend({id:C()}),Ge.extend({id:C()})]),qe=Ie([He,Ge]),Qe=R({registrationId:C(),progress:Pe,name:h(),email:h(),handynummer:h(),wantsEmailUpdates:Le(),games:Y(Ze),lastSaved:h()});R({registrationId:C(),progress:Pe,name:h(),email:h(),handynummer:h(),wantsEmailUpdates:Le(),games:Y(qe),lastSaved:h()});async function Xe(e){const t=new URL("https://elysium.gildedernacht.ch/rst24/load");t.searchParams.append("secret",e);const n=await fetch(t);if(!n.ok)return{kind:"FAILED"};const a=await n.json(),s=Qe.safeParse(a);return s.success?{kind:"SUCCESS",save:s.data}:{kind:"FAILED"}}const et=R({uuid:h(),title:V(h()),system:h(),description:V(h()),playerCount:R({min:C(),max:C()}),master:R({first:h(),last:V(h())}),slot:R({day:Fe,start:C(),end:C()})}),tt=R({id:C(),gameId:h()});async function nt(){const e=new URL("https://elysium.gildedernacht.ch/rst24/program"),t=new URL("https://elysium.gildedernacht.ch/rst24/reserved"),[n,a]=await Promise.all([fetch(e),fetch(t)]);if(!n.ok)return{kind:"FAILED"};if(!a.ok)return{kind:"FAILED"};const s=await n.json(),r=await a.json(),u=Y(et).safeParse(s);if(!u.success)return{kind:"FAILED"};const m=Y(tt).safeParse(r);return m.success?{kind:"SUCCESS",program:{gameList:u.data,reservedList:m.data}}:{kind:"FAILED"}}function pe(e,t){const a=t.gameList.filter(r=>r.slot.day===e).map(r=>{const u=r.uuid,m=t.reservedList.filter(c=>c.gameId===u);return{...r,reservedIds:m.map(c=>c.id)}});let s={};for(const r of a){const{start:u}=r.slot,m=s[u]??[];m.push(r),s[u]=m}return Object.entries(s)}var at=d("<label class=input-checkbox><input type=checkbox><!$><!/>");function rt(e){return(()=>{var t=i(at),n=t.firstChild,a=n.nextSibling,[s,r]=v(a.nextSibling);return n.addEventListener("change",u=>e.onValueUpdate(u.target.checked)),l(t,()=>e.label,s,r),O(()=>Be(n,"name",e.name)),O(()=>ye(n,"value",e.value)),O(()=>ye(n,"checked",e.checked)),t})()}var it=d("<li><h1 class=event-title></h1><div class=event-details><div class=event-tags><strong>Zeit:</strong> <!$><!/> - <!$><!/> Uhr</div><div class=event-tags><strong>Spielleitung:</strong> <!$><!/> <!$><!/></div><div class=event-tags><strong>Freie Plätze:</strong> <!$><!/></div><!$><!/></div><!$><!/><!$><!/>"),lt=d("<span>Es hat noch <strong><!$><!/> Plätze</strong> frei."),st=d("<span>Es hat noch <strong><!$><!/> Platz</strong> frei."),gt=d("<div class=event-tags><strong>Reserviert für:</strong> <!$><!/>"),dt=d('<div class="event-description content"><p><strong>Beschreibung:</strong><br><!$><!/>'),ut=d("<div>"),ct=d("<ul role=list class=event-links><li><a class=event-link href=javascript:;>+ Platz reservieren"),Ce=d("<br>"),mt=d("<div class=event-filters><h2>Filter</h2><ul role=list><li><a href=javascript:;>Alle</a></li><!$><!/>"),ot=d("<li><a href=javascript:;><!$><!/> Uhr"),vt=d("<h3 style=margin-block:1rem;>Start <!$><!/> Uhr"),$t=d("<ul class=event-list role=list>");const St=1;function _t(e){const t=[...e.confirmedReservations.map(r=>({name:r.spielerName??e.selfName,confirmed:!0})),...e.tentativeReservations.map(r=>({name:r.friendsName??e.selfName,confirmed:!1}))],n=e.confirmedReservations.map(r=>r.id),a=e.entry.reservedIds.filter(r=>!n.includes(r)),s=e.entry.playerCount.max-St-a.length-t.length;return(()=>{var r=i(it),u=r.firstChild,m=u.nextSibling,c=m.firstChild,o=c.firstChild,f=o.nextSibling,$=f.nextSibling,[T,y]=v($.nextSibling),b=T.nextSibling,L=b.nextSibling,[N,F]=v(L.nextSibling);N.nextSibling;var E=c.nextSibling,M=E.firstChild,te=M.nextSibling,ne=te.nextSibling,[j,ae]=v(ne.nextSibling),re=j.nextSibling,ie=re.nextSibling,[le,se]=v(ie.nextSibling),B=E.nextSibling,ge=B.firstChild,de=ge.nextSibling,z=de.nextSibling,[ue,ce]=v(z.nextSibling),W=B.nextSibling,[me,oe]=v(W.nextSibling),ve=m.nextSibling,[J,$e]=v(ve.nextSibling),w=J.nextSibling,[x,U]=v(w.nextSibling);return l(u,()=>e.entry.title===null?e.entry.system:`${e.entry.title} (${e.entry.system})`),l(c,()=>e.entry.slot.start,T,y),l(c,()=>e.entry.slot.end,N,F),l(E,()=>e.entry.master.first,j,ae),l(E,()=>e.entry.master.last,le,se),l(B,s>1?(()=>{var S=i(lt),A=S.firstChild,k=A.nextSibling,P=k.firstChild,[D,H]=v(P.nextSibling);return D.nextSibling,l(k,s,D,H),S})():s===1?(()=>{var S=i(st),A=S.firstChild,k=A.nextSibling,P=k.firstChild,[D,H]=v(P.nextSibling);return D.nextSibling,l(k,s,D,H),S})():"Diese Spielrunde ist bereits voll besetzt.",ue,ce),l(m,(()=>{var S=_(()=>t.length>0);return()=>S()?(()=>{var A=i(gt),k=A.firstChild,P=k.nextSibling,D=P.nextSibling,[H,Se]=v(D.nextSibling);return l(A,()=>t.map(K=>`${K.name}${K.confirmed?"":"*"}`).join(", "),H,Se),A})():null})(),me,oe),l(r,(()=>{var S=_(()=>e.entry.description!==null&&e.entry.description.trim().length>0);return()=>S()?(()=>{var A=i(dt),k=A.firstChild,P=k.firstChild,D=P.nextSibling,H=D.nextSibling,[Se,K]=v(H.nextSibling);return l(k,()=>e.entry.description,Se,K),A})():i(ut)})(),J,$e),l(r,s>0?(()=>{var S=i(ct),A=S.firstChild,k=A.firstChild;return k.$$click=()=>e.addTentativeReservation({gameUuid:e.entry.uuid,friendsName:null}),be(),S})():null,x,U),O(()=>fe(r,`event-entry ${t.length>0?"success":s>0?"special":"gray"}`)),r})()}const Z="ALL";function Me(e){const[t,n]=Ve(Z);return[i(Ce),g(rt,{get checked(){return e.wantsEmailUpdates},onValueUpdate:a=>e.updateSave("wantsEmailUpdates",a),label:"Ja, ich möchte gerne Updates erhalten, wenn neue Spielrunden aufgeschalten werden.",name:"wantsUpdates",value:"true"}),i(Ce),(()=>{var a=i(mt),s=a.firstChild,r=s.nextSibling,u=r.firstChild,m=u.firstChild,c=u.nextSibling,[o,f]=v(c.nextSibling);return m.$$click=()=>n(Z),l(r,()=>e.programByHour.map(([$,T])=>(()=>{var y=i(ot),b=y.firstChild,L=b.firstChild,[N,F]=v(L.nextSibling);return N.nextSibling,b.$$click=()=>n($),l(b,$,N,F),O(()=>fe(b,t()===$?"active":"")),be(),y})()),o,f),O(()=>fe(m,t()===Z?"active":"")),be(),a})(),_(()=>e.programByHour.filter(([a])=>a===t()||Z===t()).map(([a,s])=>[(()=>{var r=i(vt),u=r.firstChild,m=u.nextSibling,[c,o]=v(m.nextSibling);return c.nextSibling,l(r,a,c,o),r})(),(()=>{var r=i($t);return l(r,()=>s.map(u=>g(_t,{entry:u,get selfName(){return e.selfName},get confirmedReservations(){return e.confirmedReservations.filter(m=>m.game===u.uuid)},get tentativeReservations(){return e.tentativeReservations.filter(m=>m.gameUuid===u.uuid)},get addTentativeReservation(){return e.addTentativeReservation}}))),r})()]))]}Oe(["click"]);var Ae=d("<h2>Programm Samstag");function ht(e){if(e.program===null)return[i(Ae),g(I,{children:"Programm wird geladen ..."})];const t=pe("SATURDAY",e.program);return[i(Ae),g(Me,{get selfName(){return e.selfName},programByHour:t,get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get wantsEmailUpdates(){return e.wantsEmailUpdates},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave}})]}var ke=d("<h2>Programm Sonntag");function ft(e){if(e.program===null)return[i(ke),g(I,{children:"Programm wird geladen ..."})];const t=pe("SUNDAY",e.program);return[i(ke),g(Me,{get selfName(){return e.selfName},programByHour:t,get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get wantsEmailUpdates(){return e.wantsEmailUpdates},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave}})]}var bt=d("<p><strong><!$><!/> </strong>| <!$><!/>, <!$><!/> bis <!$><!/> Uhr"),yt=d("<p>Reservation für <strong>"),xt=d("<div class=content><h2>Zusammenfassung</h2><h3>Kontaktdaten</h3><ul><li><strong>Name:</strong> <!$><!/></li><li><strong>E-Mail:</strong> <!$><!/></li><li><strong>Handynummer:</strong> <!$><!/></li></ul><br><h3>Deine Reservationen</h3><!$><!/><!$><!/><!$><!/><br><h3>Updates</h3><p><em>"),Rt=d("<p><em>Noch keine Reservationen getätigt."),Ct=d("<h4>Unbestätigt"),At=d("<p>Bitte speichere deinen aktuellen Stand der Anmeldung, damit wir die folgenden Reservationen bestätigen können."),Te=d("<h5>Samstag, 24. August 2024"),q=d("<ul role=list style=display:grid;gap:.5rem;>"),Q=d("<li>"),Ne=d("<h5>Sonntag, 25. August 2024"),kt=d("<h4>Bestätigt"),Tt=d("<span style=color:var(--clr-success-10);>Ja, ich möchte gerne Updates erhalten, wenn neue Spielrunden aufgeschalten werden."),Nt=d("<span style=color:var(--clr-danger-10);>Nein, ich möchte keine E-Mails über neue Spielrunden erhalten.");function X(e){const{game:t,reservation:n}=e.reservation;return g(I,{get type(){return e.type??"gray"},get children(){return[(()=>{var a=i(bt),s=a.firstChild,r=s.firstChild,[u,m]=v(r.nextSibling);u.nextSibling;var c=s.nextSibling,o=c.nextSibling,[f,$]=v(o.nextSibling),T=f.nextSibling,y=T.nextSibling,[b,L]=v(y.nextSibling),N=b.nextSibling,F=N.nextSibling,[E,M]=v(F.nextSibling);return E.nextSibling,l(s,()=>t.title===null?t.system:`${t.title} (${t.system})`,u,m),l(a,()=>t.slot.day==="SATURDAY"?"Samstag":"Sonntag",f,$),l(a,()=>t.slot.start,b,L),l(a,()=>t.slot.end,E,M),a})(),(()=>{var a=i(yt),s=a.firstChild,r=s.nextSibling;return l(r,()=>n.friendsName===null?e.selfName:n.friendsName),a})()]}})}function Ee(e,t){const n=[],a=[];for(const s of e){const r=t?.gameList.find(u=>u.uuid===s.gameUuid);r?.slot.day==="SATURDAY"&&n.push({reservation:s,game:r}),r?.slot.day==="SUNDAY"&&a.push({reservation:s,game:r})}return{SATURDAY:n.toSorted((s,r)=>s.game.slot.start<r.game.slot.start?-1:1),SUNDAY:a.toSorted((s,r)=>s.game.slot.start<r.game.slot.start?-1:1)}}function Et(e){const t=Ee(e.save.games.map(a=>({gameUuid:a.game,friendsName:a.spielerName})),e.program),n=Ee(e.tentativeReservations,e.program);return(()=>{var a=i(xt),s=a.firstChild,r=s.nextSibling,u=r.nextSibling,m=u.firstChild,c=m.firstChild,o=c.nextSibling,f=o.nextSibling,[$,T]=v(f.nextSibling),y=m.nextSibling,b=y.firstChild,L=b.nextSibling,N=L.nextSibling,[F,E]=v(N.nextSibling),M=y.nextSibling,te=M.firstChild,ne=te.nextSibling,j=ne.nextSibling,[ae,re]=v(j.nextSibling),ie=u.nextSibling,le=ie.nextSibling,se=le.nextSibling,[B,ge]=v(se.nextSibling),de=B.nextSibling,[z,ue]=v(de.nextSibling),ce=z.nextSibling,[W,me]=v(ce.nextSibling),oe=W.nextSibling,ve=oe.nextSibling,J=ve.nextSibling,$e=J.firstChild;return l(m,()=>e.save.name,$,T),l(y,()=>e.save.email,F,E),l(M,()=>e.save.email,ae,re),l(a,(()=>{var w=_(()=>e.save.games.length===0&&e.tentativeReservations.length===0);return()=>w()?i(Rt):null})(),B,ge),l(a,(()=>{var w=_(()=>e.tentativeReservations.length>0);return()=>w()?[i(Ct),i(At),_(()=>_(()=>n.SATURDAY.length>0)()?[i(Te),(()=>{var x=i(q);return l(x,()=>n.SATURDAY.map(U=>(()=>{var S=i(Q);return l(S,g(X,{reservation:U,get selfName(){return e.save.name},type:"special"})),S})())),x})()]:null),_(()=>_(()=>n.SUNDAY.length>0)()?[i(Ne),(()=>{var x=i(q);return l(x,()=>n.SUNDAY.map(U=>(()=>{var S=i(Q);return l(S,g(X,{reservation:U,get selfName(){return e.save.name},type:"special"})),S})())),x})()]:null)]:null})(),z,ue),l(a,(()=>{var w=_(()=>e.save.games.length>0);return()=>w()?[i(kt),_(()=>_(()=>t.SATURDAY.length>0)()?[i(Te),(()=>{var x=i(q);return l(x,()=>t.SATURDAY.map(U=>(()=>{var S=i(Q);return l(S,g(X,{reservation:U,get selfName(){return e.save.name},type:"special"})),S})())),x})()]:null),_(()=>_(()=>t.SUNDAY.length>0)()?[i(Ne),(()=>{var x=i(q);return l(x,()=>t.SUNDAY.map(U=>(()=>{var S=i(Q);return l(S,g(X,{reservation:U,get selfName(){return e.save.name},type:"special"})),S})())),x})()]:null)]:null})(),W,me),l($e,(()=>{var w=_(()=>!!e.save.wantsEmailUpdates);return()=>w()?i(Tt):i(Nt)})()),a})()}var wt=d("<ul role=list style=display:flex;flex-wrap:wrap;column-gap:1rem;row-gap:.5rem;><li></li><li></li><li></li><li>"),Ut=d("<div style=display:flex;justify-content:space-between;><div></div><div>"),Dt=d("<div style=display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;gap:1rem;><div>Zuletzt gespeichert am <!$><!/></div><div style=display:flex;flex-wrap:wrap;gap:1rem;align-items:center;margin-left:auto;><p><em><small></small></em></p><!$><!/>"),It=d('<div style="padding-block:2rem 1rem;position:sticky;bottom:0;background-image:linear-gradient(transparent, var(--clr-3) 25%);">'),Lt=d("<div style=padding-block:1rem;>");function Ft(e){return(()=>{var t=i(wt),n=t.firstChild,a=n.nextSibling,s=a.nextSibling,r=s.nextSibling;return l(n,g(p,{label:"Kontaktdaten",get kind(){return e.activeTab==="Contact"?"special":"gray"},onClick:()=>e.changeTab("Contact")})),l(a,g(p,{label:"Programm Samstag",get kind(){return e.activeTab==="Saturday"?"special":"gray"},onClick:()=>e.changeTab("Saturday")})),l(s,g(p,{label:"Program Sonntag",get kind(){return e.activeTab==="Sunday"?"special":"gray"},onClick:()=>e.changeTab("Sunday")})),l(r,g(p,{label:"Zusammenfassung",get kind(){return e.activeTab==="Summary"?"special":"gray"},onClick:()=>e.changeTab("Summary")})),t})()}function Pt(e){function t(){switch(e.activeTab){case"Saturday":e.changeTab("Contact");break;case"Sunday":e.changeTab("Saturday");break;case"Summary":e.changeTab("Sunday");break}}function n(){switch(e.activeTab){case"Contact":e.changeTab("Saturday");break;case"Saturday":e.changeTab("Sunday");break;case"Sunday":e.changeTab("Summary");break}}return(()=>{var a=i(Ut),s=a.firstChild,r=s.nextSibling;return l(s,(()=>{var u=_(()=>e.activeTab!=="Contact");return()=>u()?g(p,{label:"<< Vorheriger Schritt",onClick:t}):null})()),l(r,(()=>{var u=_(()=>e.activeTab!=="Summary");return()=>u()?g(p,{label:"Nächster Schritt >>",onClick:n}):null})()),a})()}function Ht(e){const t=new Intl.DateTimeFormat("de-CH",{timeStyle:"short",dateStyle:"long"});return g(we,{get type(){return e.state==="HAS_CHANGES"?"success":"gray"},get children(){var n=i(Dt),a=n.firstChild,s=a.firstChild,r=s.nextSibling,[u,m]=v(r.nextSibling),c=a.nextSibling,o=c.firstChild,f=o.firstChild,$=f.firstChild,T=o.nextSibling,[y,b]=v(T.nextSibling);return l(a,()=>t.format(new Date(e.lastSaved)),u,m),l($,()=>e.state==="NO_CHANGES"?"keine Änderungen entdeckt":e.state==="HAS_CHANGES"?"ungespeicherte Änderungen entdeckt":""),l(c,g(p,{get disabled(){return e.state!=="HAS_CHANGES"},get label(){return e.state==="NO_CHANGES"?"Gespeichert.":e.state==="SAVING"?"Wird gespeichert...":"Speichern"},get kind(){return e.state==="HAS_CHANGES"?"success":"gray"},get onClick(){return e.saveCurrentState}}),y,b),n}})}function Gt(e){return[g(Ft,{get activeTab(){return e.activeTab},get changeTab(){return e.changeTab}}),(()=>{var t=i(Lt);return l(t,g(we,{get children(){return[_(()=>_(()=>e.activeTab==="Contact")()?g(Ke,{get save(){return e.save},get updateSave(){return e.updateSave}}):_(()=>e.activeTab==="Saturday")()?g(ht,{get selfName(){return e.save.name},get program(){return e.program},get wantsEmailUpdates(){return e.save.wantsEmailUpdates},get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave}}):_(()=>e.activeTab==="Sunday")()?g(ft,{get selfName(){return e.save.name},get program(){return e.program},get wantsEmailUpdates(){return e.save.wantsEmailUpdates},get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave}}):g(Et,{get save(){return e.save},get tentativeReservations(){return e.tentativeReservations},get program(){return e.program}})),(()=>{var n=i(It);return l(n,g(Ht,{get lastSaved(){return e.lastSaved},get saveCurrentState(){return e.saveCurrentState},get state(){return e.saveState}})),n})()]}})),t})(),g(Pt,{get activeTab(){return e.activeTab},get changeTab(){return e.changeTab}})]}var pt=d("<p>Leider ist ein unerwarteter Fehler passiert. Versuche deine Anmeldung erneut zu laden. Wiederholt sich dieser Fehler, bitte kontaktiere uns sobald als möglich über das <a href=/kontakt>Kontaktformular</a>, da dies nicht passieren sollte."),Mt=d("<p>Wir konnten leider keine Anmeldung finden. Wenn du bereits eine Anmeldung begonnen hast, solltest du den korrekten Link per E-Mail erhalten haben.<br><br> Falls du noch keine Anmeldung begonnen hast, kannst du <a href=/anmeldung>hier</a> deine persönliche Anmeldung beginnen. <br><br>Für generelle Fragen oder Probleme, schreibe uns doch bitte über unser <a href=/kontatk>Kontaktformular</a>.");function G(){return{state:"ERROR",message:i(pt)}}function Bt(){const[e,t]=We({state:"LOADING"});function n(){t({state:"ERROR",message:i(Mt)})}async function a(){const c=new URL(location.href),o=c.searchParams.get("secret"),f=c.searchParams.get("showCreateMessage")==="true";if(o===null){n();return}const $=await Xe(o),T=nt();if($.kind==="FAILED"){n();return}t({state:"IDLE",secret:o,showCreateMessage:f,lastSave:{...$.save},currentSave:$.save,activeTab:"Contact",lastSaved:$.save.lastSaved,hasChanged:!1,program:null,tentativeReservations:[]}),T.then(y=>{if(y.kind==="FAILED"){n();return}t(b=>b.state!=="IDLE"&&b.state!=="SAVING"?G():{...b,program:y.program})}),c.searchParams.delete("showCreateMessage"),history.replaceState({},document.title,c),window.scrollTo({top:0})}function s(c){t(o=>o.state!=="IDLE"&&o.state!=="SAVING"?G():{...o,activeTab:c}),window.scrollTo({top:0})}function r(c,o){t(f=>f.state!=="IDLE"&&f.state!=="SAVING"?G():{...f,currentSave:{...f.currentSave,[c]:o},hasChanged:!0})}async function u(){if(e.state!=="IDLE"){t(G());return}t("state","SAVING");const c=new URL("https://elysium.gildedernacht.ch/rst24/save"),o={...e.currentSave,games:[...e.currentSave.games,...e.tentativeReservations.map($=>$.friendsName===null?{game:$.gameUuid,self:!0,spielerName:null}:{game:$.gameUuid,self:!1,spielerName:$.friendsName})]};(await fetch(c,{method:"post",body:JSON.stringify(o),headers:{"Content-Type":"application/json"}})).ok?(t($=>$.state!=="SAVING"?G():{...$,tentativeReservations:[]}),await a()):t(G())}function m(c){t(o=>o.state!=="IDLE"&&o.state!=="SAVING"?G():{...o,hasChanged:!0,tentativeReservations:[...o.tentativeReservations,c]})}return{store:e,actions:{changeTab:s,updateSave:r,saveCurrentState:u,onFailed:n,initMeineAnmeldung:a,addTentativeReservation:m}}}var Ot=d("<code><pre>"),Vt=d("<p>Deine Anmeldung wird geladen."),he=d("<br>");function Wt(){const{store:e,actions:t}=Bt();return Ye(async()=>{await t.initMeineAnmeldung()}),[_(()=>_(()=>e.state==="ERROR")()?g(I,{type:"danger",get children(){return e.message}}):_(()=>e.state==="LOADING")()?g(I,{get children(){return i(Vt)}}):[g(ee,{get when(){return e.showCreateMessage},get children(){return[g(I,{type:"success",get children(){return["Deine Anmeldung wurde erfolgreich gestartet.",i(he),i(he),"Wir haben eine E-Mail an deine Adresse gesendet. In dieser E-Mail findest du einen persönlichen Link, um deine Anmeldung bis kurz vor dem Anlass anzupassen."]}}),i(he)]}}),g(Gt,{get activeTab(){return e.activeTab},get changeTab(){return t.changeTab},get save(){return e.currentSave},get updateSave(){return t.updateSave},get lastSaved(){return e.lastSaved},get saveCurrentState(){return t.saveCurrentState},get saveState(){return e.state==="SAVING"?"SAVING":e.hasChanged?"HAS_CHANGES":"NO_CHANGES"},get program(){return e.program},get confirmedReservations(){return e.currentSave.games},get tentativeReservations(){return e.tentativeReservations},get addTentativeReservation(){return t.addTentativeReservation}})]),(()=>{var n=i(Ot),a=n.firstChild;return l(a,()=>JSON.stringify(e,null,2)),n})()]}export{Wt as MeineAnmeldung};
