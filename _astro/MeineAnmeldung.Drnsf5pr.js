import{g as r,c as l,i as g,S as J,t as c,a as v,b as Y,s as Ge,e as ce,d as je,f as ze,j as de,r as j,k as m,l as q,h as z,M as V,n as oe,E as Ve}from"./web.B-wcHClV.js";import{I as me,B as N,a as We,S as _e,b as L}from"./Box.yRm_rtEL.js";import{e as Se,a as W,o as R,s as $,b as G,n as k,l as fe,d as Ke,u as be,f as ye,c as Ze}from"./index.DLVG7-gI.js";var Je=c("<h2>Kontaktdaten"),qe=c("<div class=content><small>Deine persönlichen Daten werden ausschliesslich verwendet, um dich über das Programm der Luzerner Rollenspieltage 2024 zu informieren. Nach dem Event werden diese gelöscht."),ne=c("<br>"),re=c("<div style=margin-block:.5rem;>");function Qe(e){let n;return[r(Je),r(qe),r(ne),l(me,{label:"Name",name:"name",get value(){return e.save.name},onValueUpdate:t=>e.updateSave("name",t)}),l(J,{get when(){return e.save.name.trim().length===0},get children(){var t=r(re);return g(t,l(N,{type:"danger",children:"Dies ist ein Pflichtfeld."})),t}}),r(ne),l(We,{label:"E-Mail",name:"email",type:"email",get value(){return e.save.email},onValueUpdate:t=>e.updateSave("email",t),ref(t){var i=n;typeof i=="function"?i(t):n=t}}),l(J,{get when(){return e.save.email.trim().length===0},get children(){var t=r(re);return g(t,l(N,{type:"danger",children:"Dies ist ein Pflichtfeld."})),t}}),l(J,{get when(){return e.save.email.length>0&&n.validity.typeMismatch},get children(){var t=r(re);return g(t,l(N,{type:"danger",children:"Die Eingabe scheint keine gültige E-Mail-Adresse zu sein."})),t}}),r(ne),l(me,{label:"Handynummer",name:"tel",type:"tel",get value(){return e.save.handynummer},required:!1,onValueUpdate:t=>e.updateSave("handynummer",t)})]}const Re=Se(["SATURDAY","SUNDAY"]);W(R({uuid:$(),description:G($()),title:G($()),system:$(),master:R({first:$(),last:G($())}),playerCount:R({min:k(),max:k()}),slot:R({day:Re,start:k(),end:k()})}));const ke=Se(["INITIALIZED","IN_PROGRESS","CONFIRMED","CONFIRMED_W_INVALID_CHANGES","CONFIRMED_W_VALID_CHANGES","RECONFIRMED"]),xe=R({game:$(),self:fe(!0),spielerName:Ke()}),Ce=R({game:$(),self:fe(!1),spielerName:$()}),Xe=be([xe.extend({id:k()}),Ce.extend({id:k()})]),et=be([xe,Ce]),tt=R({registrationId:k(),progress:ke,name:$(),email:$(),handynummer:$(),wantsEmailUpdates:ye(),games:W(Xe),lastSaved:$()});R({registrationId:k(),progress:ke,name:$(),email:$(),handynummer:$(),wantsEmailUpdates:ye(),games:W(et),lastSaved:$()});async function nt(e){const n=new URL("https://elysium.gildedernacht.ch/rst24/load");n.searchParams.append("secret",e);const t=await fetch(n);if(!t.ok)return{kind:"FAILED"};const i=await t.json(),s=tt.safeParse(i);return s.success?{kind:"SUCCESS",save:s.data}:{kind:"FAILED"}}const rt=R({uuid:$(),title:G($()),system:$(),description:G($()),playerCount:R({min:k(),max:k()}),master:R({first:$(),last:G($())}),slot:R({day:Re,start:k(),end:k()})}),at=R({id:k(),gameId:$()});async function it(){const e=new URL("https://elysium.gildedernacht.ch/rst24/program"),n=new URL("https://elysium.gildedernacht.ch/rst24/reserved"),[t,i]=await Promise.all([fetch(e),fetch(n)]);if(!t.ok)return{kind:"FAILED"};if(!i.ok)return{kind:"FAILED"};const s=await t.json(),u=await i.json(),a=W(rt).safeParse(s);if(!a.success)return{kind:"FAILED"};const o=W(at).safeParse(u);return o.success?{kind:"SUCCESS",program:{gameList:a.data,reservedList:o.data}}:{kind:"FAILED"}}function Ae(e,n){const i=n.gameList.filter(u=>u.slot.day===e).map(u=>{const a=u.uuid,o=n.reservedList.filter(d=>d.gameId===a);return{...u,reservedIds:o.map(d=>d.id)}});let s={};for(const u of i){const{start:a}=u.slot,o=s[a]??[];o.push(u),s[a]=o}return Object.entries(s)}var lt=c("<label class=input-checkbox><input type=checkbox><!$><!/>");function st(e){return(()=>{var n=r(lt),t=n.firstChild,i=t.nextSibling,[s,u]=v(i.nextSibling);return t.addEventListener("change",a=>e.onValueUpdate(a.target.checked)),g(n,()=>e.label,s,u),Y(()=>Ge(t,"name",e.name)),Y(()=>ce(t,"value",e.value)),Y(()=>ce(t,"checked",e.checked)),n})()}var dt=c("<li><h1 class=event-title></h1><div class=event-details><div class=event-tags><strong>Zeit:</strong> <!$><!/> - <!$><!/> Uhr</div><div class=event-tags><strong>Spielleitung:</strong> <!$><!/> <!$><!/></div><div class=event-tags><strong>Freie Plätze:</strong> <!$><!/></div></div><div class=event-description><!$><!/><!$><!/></div><!$><!/>"),ut=c("<span>Es hat noch <strong><!$><!/> Plätze</strong> frei."),gt=c("<span>Es hat noch <strong><!$><!/> Platz</strong> frei."),ct=c('<div class="event-description content"><p><strong>Beschreibung:</strong><br><!$><!/>'),ot=c("<div><p><strong>Deine Reservationen</strong></p><ul>"),mt=c("<li style=font-size:0.83rem;>"),vt=c("<s>"),ve=c('<span title="ungespeicherte Änderung"> *'),$t=c('<a href=javascript:; style=border:none; title="Reservation löschen"><i class="fa-duotone fa-circle-xmark">'),ht=c("<ul role=list class=event-links><li><a class=event-link href=javascript:;>+ Platz für mich reservieren"),_t=c("<ul role=list class=event-links><li><a class=event-link href=javascript:;>+ Platz für Begleitung reservieren"),St=c(`<style>
          .event-filters .active {
            color: var(--clr-success-10) !important;
          }
        `),ft=c("<div class=content><small>Auf dieser Seite kannst du dich und deine Freunde für Spielrunden einschreiben, solange es freie Plätze hat."),$e=c("<br>"),bt=c("<div class=event-filters><h2>Filter</h2><ul role=list><li><a href=javascript:;>Alle</a></li><!$><!/>"),yt=c("<li><a href=javascript:;><!$><!/> Uhr"),Rt=c("<h3 style=margin-block:1rem;>Start <!$><!/> Uhr"),kt=c("<ul class=event-list role=list>");const xt=1;function Ct(e){function n(){return[...e.confirmedReservations.map(i=>({name:i.spielerName??e.selfName,confirmed:!0,gameUuid:e.entry.uuid,reservationId:i.id,markedForDeletion:e.markedForDeletionReservations.includes(i.id)})),...e.tentativeReservations.map(i=>({name:i.friendsName??e.selfName,confirmed:!1,gameUuid:e.entry.uuid,markedForDeletion:!1}))]}function t(){const i=e.confirmedReservations.map(u=>u.id),s=e.entry.reservedIds.filter(u=>!i.includes(u));return e.entry.playerCount.max-xt-s.length-n().filter(u=>!u.markedForDeletion).length}return(()=>{var i=r(dt),s=i.firstChild,u=s.nextSibling,a=u.firstChild,o=a.firstChild,d=o.nextSibling,h=d.nextSibling,[S,_]=v(h.nextSibling),T=S.nextSibling,E=T.nextSibling,[x,D]=v(E.nextSibling);x.nextSibling;var w=a.nextSibling,I=w.firstChild,P=I.nextSibling,p=P.nextSibling,[K,Q]=v(p.nextSibling),X=K.nextSibling,ee=X.nextSibling,[te,De]=v(ee.nextSibling),ue=w.nextSibling,we=ue.firstChild,Ne=we.nextSibling,Ue=Ne.nextSibling,[Fe,Ie]=v(Ue.nextSibling),Z=u.nextSibling,Pe=Z.firstChild,[ge,He]=v(Pe.nextSibling),Le=ge.nextSibling,[pe,Me]=v(Le.nextSibling),Be=Z.nextSibling,[Oe,Ye]=v(Be.nextSibling);return g(s,()=>e.entry.title===null?e.entry.system:`${e.entry.title} (${e.entry.system})`),g(a,()=>e.entry.slot.start,S,_),g(a,()=>e.entry.slot.end,x,D),g(w,()=>e.entry.master.first,K,Q),g(w,()=>e.entry.master.last,te,De),g(ue,(()=>{var U=m(()=>t()>1);return()=>U()?(()=>{var C=r(ut),b=C.firstChild,A=b.nextSibling,f=A.firstChild,[y,H]=v(f.nextSibling);return y.nextSibling,g(A,t,y,H),C})():(()=>{var C=m(()=>t()===1);return()=>C()?(()=>{var b=r(gt),A=b.firstChild,f=A.nextSibling,y=f.firstChild,[H,F]=v(y.nextSibling);return H.nextSibling,g(f,t,H,F),b})():"Diese Spielrunde ist bereits voll besetzt."})()})(),Fe,Ie),g(Z,(()=>{var U=m(()=>e.entry.description!==null&&e.entry.description.trim().length>0);return()=>U()?(()=>{var C=r(ct),b=C.firstChild,A=b.firstChild,f=A.nextSibling,y=f.nextSibling,[H,F]=v(y.nextSibling);return g(b,()=>e.entry.description,H,F),C})():null})(),ge,He),g(Z,(()=>{var U=m(()=>n().length>0);return()=>U()?(()=>{var C=r(ot),b=C.firstChild,A=b.nextSibling;return g(A,()=>n().map(f=>(()=>{var y=r(mt);return g(y,(()=>{var H=m(()=>!!f.markedForDeletion);return()=>H()?[(()=>{var F=r(vt);return g(F,()=>f.name),F})(),r(ve)]:[m(()=>f.name),m(()=>m(()=>!!f.confirmed)()?null:r(ve)),(()=>{var F=r($t);return F.$$click=()=>e.deleteReservation(f),j(),F})()]})()),y})())),C})():null})(),pe,Me),g(i,(()=>{var U=m(()=>t()>0);return()=>U()?(()=>{var C=m(()=>n().length===0);return()=>C()?(()=>{var b=r(ht),A=b.firstChild,f=A.firstChild;return f.$$click=()=>e.addTentativeReservation({gameUuid:e.entry.uuid,friendsName:null}),j(),b})():(()=>{var b=r(_t),A=b.firstChild,f=A.firstChild;return f.$$click=()=>{const y=prompt("Bitte teile uns mit, wie deine Begleitung heisst:");y!==null&&y.trim().length>0&&e.addTentativeReservation({gameUuid:e.entry.uuid,friendsName:y})},j(),b})()})():null})(),Oe,Ye),Y(()=>de(i,`event-entry ${n().filter(U=>!U.markedForDeletion).length>0?"success":t()>0?"special":"gray"}`)),i})()}function Te(e){const[n,t]=ze([]);function i(s){t(u=>u.includes(s)?u.filter(a=>a!==s):[...u,s])}return[r(St),r(ft),r($e),l(st,{get checked(){return e.wantsEmailUpdates},onValueUpdate:s=>e.updateSave("wantsEmailUpdates",s),label:"Ja, ich möchte gerne Updates erhalten, wenn neue Spielrunden aufgeschalten werden.",name:"wantsUpdates",value:"true"}),r($e),(()=>{var s=r(bt),u=s.firstChild,a=u.nextSibling,o=a.firstChild,d=o.firstChild,h=o.nextSibling,[S,_]=v(h.nextSibling);return d.$$click=()=>t([]),g(a,()=>e.programByHour.map(([T,E])=>(()=>{var x=r(yt),D=x.firstChild,w=D.firstChild,[I,P]=v(w.nextSibling);return I.nextSibling,D.$$click=()=>i(T),g(D,T,I,P),Y(()=>de(D,n().includes(T)?"active":"")),j(),x})()),S,_),Y(()=>de(d,n().length===0?"active":"")),j(),s})(),m(()=>e.programByHour.filter(([s])=>n().includes(s)||n().length===0).map(([s,u])=>[(()=>{var a=r(Rt),o=a.firstChild,d=o.nextSibling,[h,S]=v(d.nextSibling);return h.nextSibling,g(a,s,h,S),a})(),(()=>{var a=r(kt);return g(a,()=>u.map(o=>l(Ct,{entry:o,get selfName(){return e.selfName},get confirmedReservations(){return e.confirmedReservations.filter(d=>d.game===o.uuid)},get tentativeReservations(){return e.tentativeReservations.filter(d=>d.gameUuid===o.uuid)},get markedForDeletionReservations(){return e.markedForDeletionReservations},get addTentativeReservation(){return e.addTentativeReservation},get deleteReservation(){return e.deleteReservation}}))),a})()]))]}je(["click"]);function At(e){const n=Ae("SATURDAY",e.program);return l(Te,{get selfName(){return e.selfName},programByHour:n,get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get markedForDeletionReservations(){return e.markedForDeletionReservations},get wantsEmailUpdates(){return e.wantsEmailUpdates},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave},get deleteReservation(){return e.deleteReservation}})}function Tt(e){const n=Ae("SUNDAY",e.program);return l(Te,{get selfName(){return e.selfName},programByHour:n,get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get markedForDeletionReservations(){return e.markedForDeletionReservations},get wantsEmailUpdates(){return e.wantsEmailUpdates},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave},get deleteReservation(){return e.deleteReservation}})}var Et=c("<p><strong><!$><!/> </strong>| <!$><!/>, <!$><!/> bis <!$><!/> Uhr"),Dt=c("<p>Reservation für <strong>"),wt=c("<h3>Kontaktdaten"),Nt=c("<ul><li><strong>Name:</strong> <!$><!/></li><li><strong>E-Mail:</strong> <!$><!/></li><li><strong>Handynummer:</strong> <!$><!/>"),he=c("<br>"),Ut=c("<h3>Deine Reservationen"),Ft=c("<h3>Updates"),It=c("<p><em>"),Pt=c("<p><em>Noch keine Reservationen getätigt."),Ht=c("<h4>Unbestätigt"),Lt=c("<p>Bitte speichere deinen aktuellen Stand der Anmeldung, damit wir die folgenden Reservationen bestätigen können."),ae=c("<h5>Samstag, 24. August 2024"),M=c("<ul role=list style=display:grid;gap:.5rem;>"),B=c("<li>"),ie=c("<h5>Sonntag, 25. August 2024"),pt=c("<h4>Reservationen, die du entfernen möchtest"),Mt=c("<p>Bitte speichere deinen aktuellen Stand der Anmeldung, damit wir die folgenden Reservationen entfernen können."),Bt=c("<h4>Bestätigt"),Ot=c("<span style=color:var(--clr-success-10);>Ja, ich möchte gerne Updates erhalten, wenn neue Spielrunden aufgeschalten werden."),Yt=c("<span style=color:var(--clr-danger-10);>Nein, ich möchte keine E-Mails über neue Spielrunden erhalten.");function O(e){const{game:n,reservation:t}=e.reservation;return l(N,{get type(){return e.type??"gray"},get children(){return[(()=>{var i=r(Et),s=i.firstChild,u=s.firstChild,[a,o]=v(u.nextSibling);a.nextSibling;var d=s.nextSibling,h=d.nextSibling,[S,_]=v(h.nextSibling),T=S.nextSibling,E=T.nextSibling,[x,D]=v(E.nextSibling),w=x.nextSibling,I=w.nextSibling,[P,p]=v(I.nextSibling);return P.nextSibling,g(s,()=>n.title===null?n.system:`${n.title} (${n.system})`,a,o),g(i,()=>n.slot.day==="SATURDAY"?"Samstag":"Sonntag",S,_),g(i,()=>n.slot.start,x,D),g(i,()=>n.slot.end,P,p),i})(),(()=>{var i=r(Dt),s=i.firstChild,u=s.nextSibling;return g(u,()=>t.friendsName===null?e.selfName:t.friendsName),i})()]}})}function le(e,n){const t=[],i=[];for(const s of e){const u=n.gameList.find(a=>a.uuid===s.gameUuid);u?.slot.day==="SATURDAY"&&t.push({reservation:s,game:u}),u?.slot.day==="SUNDAY"&&i.push({reservation:s,game:u})}return{SATURDAY:t.toSorted((s,u)=>s.game.slot.start<u.game.slot.start?-1:1),SUNDAY:i.toSorted((s,u)=>s.game.slot.start<u.game.slot.start?-1:1)}}function Gt(e){const{con:n,del:t}=e.save.games.reduce((a,o)=>e.markedForDeletionReservations.includes(o.id)?{...a,del:[...a.del,o]}:{...a,con:[...a.con,o]},{con:[],del:[]}),i=le(n.map(a=>({gameUuid:a.game,friendsName:a.spielerName})),e.program),s=le(t.map(a=>({gameUuid:a.game,friendsName:a.spielerName})),e.program),u=le(e.tentativeReservations,e.program);return[r(wt),(()=>{var a=r(Nt),o=a.firstChild,d=o.firstChild,h=d.nextSibling,S=h.nextSibling,[_,T]=v(S.nextSibling),E=o.nextSibling,x=E.firstChild,D=x.nextSibling,w=D.nextSibling,[I,P]=v(w.nextSibling),p=E.nextSibling,K=p.firstChild,Q=K.nextSibling,X=Q.nextSibling,[ee,te]=v(X.nextSibling);return g(o,()=>e.save.name,_,T),g(E,()=>e.save.email,I,P),g(p,()=>e.save.handynummer,ee,te),a})(),r(he),r(Ut),m(()=>m(()=>e.save.games.length===0&&e.tentativeReservations.length===0)()?r(Pt):null),m(()=>m(()=>e.tentativeReservations.length>0)()?[r(Ht),r(Lt),m(()=>m(()=>u.SATURDAY.length>0)()?[r(ae),(()=>{var a=r(M);return g(a,()=>u.SATURDAY.map(o=>(()=>{var d=r(B);return g(d,l(O,{reservation:o,get selfName(){return e.save.name},type:"special"})),d})())),a})()]:null),m(()=>m(()=>u.SUNDAY.length>0)()?[r(ie),(()=>{var a=r(M);return g(a,()=>u.SUNDAY.map(o=>(()=>{var d=r(B);return g(d,l(O,{reservation:o,get selfName(){return e.save.name},type:"special"})),d})())),a})()]:null)]:null),m(()=>m(()=>t.length>0)()?[r(pt),r(Mt),m(()=>m(()=>s.SATURDAY.length>0)()?[r(ae),(()=>{var a=r(M);return g(a,()=>s.SATURDAY.map(o=>(()=>{var d=r(B);return g(d,l(O,{reservation:o,get selfName(){return e.save.name},type:"danger"})),d})())),a})()]:null),m(()=>m(()=>s.SUNDAY.length>0)()?[r(ie),(()=>{var a=r(M);return g(a,()=>s.SUNDAY.map(o=>(()=>{var d=r(B);return g(d,l(O,{reservation:o,get selfName(){return e.save.name},type:"danger"})),d})())),a})()]:null)]:null),m(()=>m(()=>n.length>0)()?[r(Bt),m(()=>m(()=>i.SATURDAY.length>0)()?[r(ae),(()=>{var a=r(M);return g(a,()=>i.SATURDAY.map(o=>(()=>{var d=r(B);return g(d,l(O,{reservation:o,get selfName(){return e.save.name},type:"success"})),d})())),a})()]:null),m(()=>m(()=>i.SUNDAY.length>0)()?[r(ie),(()=>{var a=r(M);return g(a,()=>i.SUNDAY.map(o=>(()=>{var d=r(B);return g(d,l(O,{reservation:o,get selfName(){return e.save.name},type:"success"})),d})())),a})()]:null)]:null),r(he),r(Ft),(()=>{var a=r(It),o=a.firstChild;return g(o,(()=>{var d=m(()=>!!e.save.wantsEmailUpdates);return()=>d()?r(Ot):r(Yt)})()),a})()]}var jt=c("<ul role=list style=display:flex;flex-wrap:wrap;column-gap:1rem;row-gap:.5rem;><li></li><li></li><li></li><li>"),zt=c("<div style=display:flex;justify-content:space-between;><div></div><div>"),Vt=c("<div style=display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;gap:1rem;><div>Zuletzt gespeichert am <!$><!/></div><div style=display:flex;flex-wrap:wrap;gap:1rem;align-items:center;margin-left:auto;><p><em><small></small></em></p><!$><!/>"),Wt=c('<div style="padding-block:2rem 1rem;position:sticky;bottom:0;background-image:linear-gradient(transparent, var(--clr-3) 25%);">'),Kt=c("<div style=padding-block:1rem;>"),Zt=c("<h2>Programm Samstag"),Jt=c("<h2>Programm Sonntag"),qt=c("<div class=content><h2>Zusammenfassung</h2><small>Hier hast du die komplette Übersicht über alle deine Eingaben. Du kannst bis am <strong>Freitag, 23. August 2024</strong> zurückkommen und deine Kontaktdaten und Reservationen anpassen.</small><!$><!/>");function Qt(e){return(()=>{var n=r(jt),t=n.firstChild,i=t.nextSibling,s=i.nextSibling,u=s.nextSibling;return g(t,l(L,{label:"Kontaktdaten",get kind(){return e.activeTab==="Contact"?"special":"gray"},onClick:()=>e.changeTab("Contact")})),g(i,l(L,{label:"Programm Samstag",get kind(){return e.activeTab==="Saturday"?"special":"gray"},onClick:()=>e.changeTab("Saturday")})),g(s,l(L,{label:"Program Sonntag",get kind(){return e.activeTab==="Sunday"?"special":"gray"},onClick:()=>e.changeTab("Sunday")})),g(u,l(L,{label:"Zusammenfassung",get kind(){return e.activeTab==="Summary"?"special":"gray"},onClick:()=>e.changeTab("Summary")})),n})()}function Xt(e){function n(){switch(e.activeTab){case"Saturday":e.changeTab("Contact");break;case"Sunday":e.changeTab("Saturday");break;case"Summary":e.changeTab("Sunday");break}}function t(){switch(e.activeTab){case"Contact":e.changeTab("Saturday");break;case"Saturday":e.changeTab("Sunday");break;case"Sunday":e.changeTab("Summary");break}}return(()=>{var i=r(zt),s=i.firstChild,u=s.nextSibling;return g(s,(()=>{var a=m(()=>e.activeTab!=="Contact");return()=>a()?l(L,{label:"<< Vorheriger Schritt",onClick:n}):null})()),g(u,(()=>{var a=m(()=>e.activeTab!=="Summary");return()=>a()?l(L,{label:"Nächster Schritt >>",onClick:t}):null})()),i})()}function en(e){const n=new Intl.DateTimeFormat("de-CH",{timeStyle:"short",dateStyle:"long"});return l(_e,{get type(){return e.state==="HAS_CHANGES"?"success":"gray"},get children(){var t=r(Vt),i=t.firstChild,s=i.firstChild,u=s.nextSibling,[a,o]=v(u.nextSibling),d=i.nextSibling,h=d.firstChild,S=h.firstChild,_=S.firstChild,T=h.nextSibling,[E,x]=v(T.nextSibling);return g(i,()=>n.format(new Date(e.lastSaved)),a,o),g(_,()=>e.state==="NO_CHANGES"?"keine Änderungen entdeckt":e.state==="HAS_CHANGES"?"ungespeicherte Änderungen entdeckt":""),g(d,l(L,{get disabled(){return e.state!=="HAS_CHANGES"},get label(){return e.state==="NO_CHANGES"?"Gespeichert.":e.state==="SAVING"?"Wird gespeichert...":"Speichern"},get kind(){return e.state==="HAS_CHANGES"?"success":"gray"},get onClick(){return e.saveCurrentState}}),E,x),t}})}function tn(e){return[l(Qt,{get activeTab(){return e.activeTab},get changeTab(){return e.changeTab}}),(()=>{var n=r(Kt);return g(n,l(_e,{get children(){return[m(()=>m(()=>e.activeTab==="Contact")()?l(Qe,{get save(){return e.save},get updateSave(){return e.updateSave}}):m(()=>e.activeTab==="Saturday")()?[r(Zt),l(q,{get fallback(){return l(N,{children:"Programm wird geladen ..."})},get children(){return l(z,{get children(){return l(V,{get when(){return e.programResource()},children:t=>l(At,{get selfName(){return e.save.name},get program(){return t()},get wantsEmailUpdates(){return e.save.wantsEmailUpdates},get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get markedForDeletionReservations(){return e.markedForDeletionReservations},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave},get deleteReservation(){return e.deleteReservation}})})}})}})]:m(()=>e.activeTab==="Sunday")()?[r(Jt),l(q,{get fallback(){return l(N,{children:"Programm wird geladen ..."})},get children(){return l(z,{get children(){return l(V,{get when(){return e.programResource()},children:t=>l(Tt,{get selfName(){return e.save.name},get program(){return t()},get wantsEmailUpdates(){return e.save.wantsEmailUpdates},get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get markedForDeletionReservations(){return e.markedForDeletionReservations},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave},get deleteReservation(){return e.deleteReservation}})})}})}})]:(()=>{var t=r(qt),i=t.firstChild,s=i.nextSibling,u=s.nextSibling,[a,o]=v(u.nextSibling);return g(t,l(q,{get fallback(){return l(N,{children:"Zusammenfassung wird geladen ..."})},get children(){return l(z,{get children(){return l(V,{get when(){return e.programResource()},children:d=>l(Gt,{get save(){return e.save},get tentativeReservations(){return e.tentativeReservations},get program(){return d()},get markedForDeletionReservations(){return e.markedForDeletionReservations}})})}})}}),a,o),t})()),(()=>{var t=r(Wt);return g(t,l(en,{get lastSaved(){return e.lastSaved},get saveCurrentState(){return e.saveCurrentState},get state(){return e.saveState}})),t})()]}})),n})(),l(Xt,{get activeTab(){return e.activeTab},get changeTab(){return e.changeTab}})]}function nn(){const e=new URL(location.href),n=e.searchParams.get("secret"),t=e.searchParams.get("showCreateMessage")==="true";return{secret:n,showCreateMessage:t}}async function Ee(e){if(e.secret===null)throw Error("SECRET_ERROR");const n=await nt(e.secret);if(n.kind==="FAILED")throw Error("SECRET_ERROR");return{state:"IDLE",secret:e.secret,showCreateMessage:e.showCreateMessage,currentSave:n.save,activeTab:"Contact",lastSaved:n.save.lastSaved,hasChanged:!1,tentativeReservations:[],markedForDeletionReservations:[]}}async function rn(){const e=await it();if(e.kind==="FAILED")throw Error("PROGRAM_ERROR");return e.program}function an(e){const[n,t]=Ze(e);function i(d){t("activeTab",d),window.scrollTo({top:0})}function s(d,h){t("hasChanged",!0),t("currentSave",d,h)}async function u(){if(n.state!=="IDLE")throw Error("ASSERTION_ERROR");t("state","SAVING");const d=new URL("https://elysium.gildedernacht.ch/rst24/save"),h={...n.currentSave,games:[...n.currentSave.games.filter(_=>!n.markedForDeletionReservations.includes(_.id)),...n.tentativeReservations.map(_=>_.friendsName===null?{game:_.gameUuid,self:!0,spielerName:null}:{game:_.gameUuid,self:!1,spielerName:_.friendsName})]};if((await fetch(d,{method:"post",body:JSON.stringify(h),headers:{"Content-Type":"application/json"}})).ok){const _=await Ee({secret:n.secret,showCreateMessage:!1});t({..._,activeTab:n.activeTab})}else throw Error("SAVE_ERROR")}function a(d){t("hasChanged",!0),t("tentativeReservations",h=>[...h,d])}function o(d){if(d.confirmed)t("hasChanged",!0),t("markedForDeletionReservations",h=>[...h,d.reservationId]);else{const h=n.currentSave.name;t("tentativeReservations",S=>S.filter(_=>_.gameUuid!==d.gameUuid?!0:_.friendsName===d.name?!1:d.name!==h))}}return{state:n,actions:{changeTab:i,updateSave:s,saveCurrentState:u,addTentativeReservation:a,deleteReservation:o}}}var se=c("<br>"),ln=c("<strong>Freitag, 23. August 2024"),sn=c("<p>Wir konnten leider keine Anmeldung finden. Wenn du bereits eine Anmeldung begonnen hast, solltest du den korrekten Link per E-Mail erhalten haben.<br><br> Falls du noch keine Anmeldung begonnen hast, kannst du <a href=/anmeldung>hier</a> deine persönliche Anmeldung beginnen. <br><br>Für generelle Fragen oder Probleme, schreibe uns doch bitte über unser <a href=/kontatk>Kontaktformular</a>."),dn=c("<p>Leider ist ein unerwarteter Fehler passiert. Versuche deine Anmeldung erneut zu laden. Wiederholt sich dieser Fehler, bitte kontaktiere uns sobald als möglich über das <a href=/kontakt>Kontaktformular</a>, da dies nicht passieren sollte."),un=c("<p>Deine Anmeldung wird geladen...");function gn(e){const{state:n,actions:t}=an(e.state);return[l(J,{get when(){return n.showCreateMessage},get children(){return[l(N,{type:"success",get children(){return["Deine Anmeldung wurde erfolgreich gestartet.",r(se),r(se),"Wir haben eine E-Mail an deine Adresse gesendet. In dieser E-Mail findest du einen persönlichen Link, um deine Anmeldung bis am"," ",r(ln)," anzupassen."]}}),r(se)]}}),l(tn,{get activeTab(){return n.activeTab},get changeTab(){return t.changeTab},get save(){return n.currentSave},get updateSave(){return t.updateSave},get lastSaved(){return n.lastSaved},get saveCurrentState(){return t.saveCurrentState},get saveState(){return n.state==="SAVING"?"SAVING":n.hasChanged?"HAS_CHANGES":"NO_CHANGES"},get programResource(){return e.programResource},get confirmedReservations(){return n.currentSave.games},get tentativeReservations(){return n.tentativeReservations},get addTentativeReservation(){return t.addTentativeReservation},get deleteReservation(){return t.deleteReservation},get markedForDeletionReservations(){return n.markedForDeletionReservations}})]}function vn(){const e=nn(),[n]=oe(()=>Ee(e)),[t]=oe(()=>rn());return l(Ve,{fallback:i=>l(N,{type:"danger",get children(){return l(z,{get fallback(){return r(dn)},get children(){return l(V,{get when(){return i.message==="SECRET_ERROR"},get children(){return r(sn)}})}})}}),get children(){return l(q,{get fallback(){return l(N,{get children(){return r(un)}})},get children(){return l(z,{get children(){return l(V,{get when(){return n()},children:i=>l(gn,{get state(){return i()},programResource:t})})}})}})}})}export{vn as MeineAnmeldung};
