import{g as r,c as u,i,S as ee,t as g,a as v,b as B,s as pe,d as fe,e as Me,f as Be,h as _e,r as he,j as $,o as Oe}from"./web.DDKVi3E9.js";import{I as be,B as w,a as Ve,S as Ne,b as H}from"./Box.iyaGn6e6.js";import{e as Ee,a as Y,o as C,s as S,b as O,n as A,l as we,d as Ye,u as Ue,f as De,c as je}from"./index.CxgbH3Vf.js";var ze=g("<h2>Kontaktdaten"),$e=g("<div style=margin-block:.5rem;>"),ye=g("<br>");function We(e){let t;return[r(ze),u(be,{label:"Name",name:"name",get value(){return e.save.name},onValueUpdate:n=>e.updateSave("name",n)}),u(ee,{get when(){return e.save.name.trim().length===0},get children(){var n=r($e);return i(n,u(w,{type:"danger",children:"Dies ist ein Pflichtfeld."})),n}}),r(ye),u(Ve,{label:"E-Mail",name:"email",type:"email",get value(){return e.save.email},onValueUpdate:n=>e.updateSave("email",n),ref(n){var a=t;typeof a=="function"?a(n):t=n}}),u(ee,{get when(){return e.save.email.trim().length===0},get children(){var n=r($e);return i(n,u(w,{type:"danger",children:"Dies ist ein Pflichtfeld."})),n}}),u(ee,{get when(){return e.save.email.length>0&&t.validity.typeMismatch},get children(){var n=r($e);return i(n,u(w,{type:"danger",children:"Die Eingabe scheint keine gültige E-Mail-Adresse zu sein."})),n}}),r(ye),u(be,{label:"Handynummer",name:"tel",type:"tel",get value(){return e.save.handynummer},required:!1,onValueUpdate:n=>e.updateSave("handynummer",n)})]}const Ie=Ee(["SATURDAY","SUNDAY"]);Y(C({uuid:S(),description:O(S()),title:O(S()),system:S(),master:C({first:S(),last:O(S())}),playerCount:C({min:A(),max:A()}),slot:C({day:Ie,start:A(),end:A()})}));const Le=Ee(["INITIALIZED","IN_PROGRESS","CONFIRMED","CONFIRMED_W_INVALID_CHANGES","CONFIRMED_W_VALID_CHANGES","RECONFIRMED"]),Fe=C({game:S(),self:we(!0),spielerName:Ye()}),Pe=C({game:S(),self:we(!1),spielerName:S()}),Je=Ue([Fe.extend({id:A()}),Pe.extend({id:A()})]),Ke=Ue([Fe,Pe]),Ze=C({registrationId:A(),progress:Le,name:S(),email:S(),handynummer:S(),wantsEmailUpdates:De(),games:Y(Je),lastSaved:S()});C({registrationId:A(),progress:Le,name:S(),email:S(),handynummer:S(),wantsEmailUpdates:De(),games:Y(Ke),lastSaved:S()});async function qe(e){const t=new URL("https://elysium.gildedernacht.ch/rst24/load");t.searchParams.append("secret",e);const n=await fetch(t);if(!n.ok)return{kind:"FAILED"};const a=await n.json(),s=Ze.safeParse(a);return s.success?{kind:"SUCCESS",save:s.data}:{kind:"FAILED"}}const Qe=C({uuid:S(),title:O(S()),system:S(),description:O(S()),playerCount:C({min:A(),max:A()}),master:C({first:S(),last:O(S())}),slot:C({day:Ie,start:A(),end:A()})}),Xe=C({id:A(),gameId:S()});async function et(){const e=new URL("https://elysium.gildedernacht.ch/rst24/program"),t=new URL("https://elysium.gildedernacht.ch/rst24/reserved"),[n,a]=await Promise.all([fetch(e),fetch(t)]);if(!n.ok)return{kind:"FAILED"};if(!a.ok)return{kind:"FAILED"};const s=await n.json(),l=await a.json(),d=Y(Qe).safeParse(s);if(!d.success)return{kind:"FAILED"};const o=Y(Xe).safeParse(l);return o.success?{kind:"SUCCESS",program:{gameList:d.data,reservedList:o.data}}:{kind:"FAILED"}}function He(e,t){const a=t.gameList.filter(l=>l.slot.day===e).map(l=>{const d=l.uuid,o=t.reservedList.filter(c=>c.gameId===d);return{...l,reservedIds:o.map(c=>c.id)}});let s={};for(const l of a){const{start:d}=l.slot,o=s[d]??[];o.push(l),s[d]=o}return Object.entries(s)}var tt=g("<label class=input-checkbox><input type=checkbox><!$><!/>");function nt(e){return(()=>{var t=r(tt),n=t.firstChild,a=n.nextSibling,[s,l]=v(a.nextSibling);return n.addEventListener("change",d=>e.onValueUpdate(d.target.checked)),i(t,()=>e.label,s,l),B(()=>pe(n,"name",e.name)),B(()=>fe(n,"value",e.value)),B(()=>fe(n,"checked",e.checked)),t})()}var at=g("<li><h1 class=event-title></h1><div class=event-details><div class=event-tags><strong>Zeit:</strong> <!$><!/> - <!$><!/> Uhr</div><div class=event-tags><strong>Spielleitung:</strong> <!$><!/> <!$><!/></div><div class=event-tags><strong>Freie Plätze:</strong> <!$><!/></div><!$><!/></div><!$><!/><!$><!/>"),rt=g("<span>Es hat noch <strong><!$><!/> Plätze</strong> frei."),it=g("<span>Es hat noch <strong><!$><!/> Platz</strong> frei."),lt=g("<div class=event-tags><strong>Reserviert für:</strong> <!$><!/>"),st=g('<div class="event-description content"><p><strong>Beschreibung:</strong><br><!$><!/>'),ut=g("<div>"),gt=g("<ul role=list class=event-links><li><a class=event-link href=javascript:;>+ Platz reservieren"),xe=g("<br>"),dt=g("<div class=event-filters><h2>Filter</h2><ul role=list><li><a href=javascript:;>Alle</a></li><!$><!/>"),ct=g("<li><a href=javascript:;><!$><!/> Uhr"),mt=g("<h3 style=margin-block:1rem;>Start <!$><!/> Uhr"),ot=g("<ul class=event-list role=list>");const vt=1;function $t(e){function t(){return[...e.confirmedReservations.map(a=>({name:a.spielerName??e.selfName,confirmed:!0})),...e.tentativeReservations.map(a=>({name:a.friendsName??e.selfName,confirmed:!1}))]}function n(){const a=e.confirmedReservations.map(l=>l.id),s=e.entry.reservedIds.filter(l=>!a.includes(l));return e.entry.playerCount.max-vt-s.length-t().length}return(()=>{var a=r(at),s=a.firstChild,l=s.nextSibling,d=l.firstChild,o=d.firstChild,c=o.nextSibling,m=c.nextSibling,[b,_]=v(m.nextSibling),T=b.nextSibling,R=T.nextSibling,[x,L]=v(R.nextSibling);x.nextSibling;var k=d.nextSibling,F=k.firstChild,G=F.nextSibling,p=G.nextSibling,[j,te]=v(p.nextSibling),ne=j.nextSibling,ae=ne.nextSibling,[re,ie]=v(ae.nextSibling),V=k.nextSibling,le=V.firstChild,z=le.nextSibling,se=z.nextSibling,[ue,W]=v(se.nextSibling),ge=V.nextSibling,[de,J]=v(ge.nextSibling),ce=l.nextSibling,[K,me]=v(ce.nextSibling),oe=K.nextSibling,[ve,E]=v(oe.nextSibling);return i(s,()=>e.entry.title===null?e.entry.system:`${e.entry.title} (${e.entry.system})`),i(d,()=>e.entry.slot.start,b,_),i(d,()=>e.entry.slot.end,x,L),i(k,()=>e.entry.master.first,j,te),i(k,()=>e.entry.master.last,re,ie),i(V,(()=>{var y=$(()=>n()>1);return()=>y()?(()=>{var f=r(rt),h=f.firstChild,N=h.nextSibling,U=N.firstChild,[D,I]=v(U.nextSibling);return D.nextSibling,i(N,n,D,I),f})():(()=>{var f=$(()=>n()===1);return()=>f()?(()=>{var h=r(it),N=h.firstChild,U=N.nextSibling,D=U.firstChild,[I,M]=v(D.nextSibling);return I.nextSibling,i(U,n,I,M),h})():"Diese Spielrunde ist bereits voll besetzt."})()})(),ue,W),i(l,(()=>{var y=$(()=>t().length>0);return()=>y()?(()=>{var f=r(lt),h=f.firstChild,N=h.nextSibling,U=N.nextSibling,[D,I]=v(U.nextSibling);return i(f,()=>t().map(M=>`${M.name}${M.confirmed?"":"*"}`).join(", "),D,I),f})():null})(),de,J),i(a,(()=>{var y=$(()=>e.entry.description!==null&&e.entry.description.trim().length>0);return()=>y()?(()=>{var f=r(st),h=f.firstChild,N=h.firstChild,U=N.nextSibling,D=U.nextSibling,[I,M]=v(D.nextSibling);return i(h,()=>e.entry.description,I,M),f})():r(ut)})(),K,me),i(a,(()=>{var y=$(()=>n()>0);return()=>y()?(()=>{var f=r(gt),h=f.firstChild,N=h.firstChild;return N.$$click=()=>e.addTentativeReservation({gameUuid:e.entry.uuid,friendsName:null}),he(),f})():null})(),ve,E),B(()=>_e(a,`event-entry ${t().length>0?"success":n()>0?"special":"gray"}`)),a})()}const Z="ALL";function Ge(e){const[t,n]=Be(Z);return[r(xe),u(nt,{get checked(){return e.wantsEmailUpdates},onValueUpdate:a=>e.updateSave("wantsEmailUpdates",a),label:"Ja, ich möchte gerne Updates erhalten, wenn neue Spielrunden aufgeschalten werden.",name:"wantsUpdates",value:"true"}),r(xe),(()=>{var a=r(dt),s=a.firstChild,l=s.nextSibling,d=l.firstChild,o=d.firstChild,c=d.nextSibling,[m,b]=v(c.nextSibling);return o.$$click=()=>n(Z),i(l,()=>e.programByHour.map(([_,T])=>(()=>{var R=r(ct),x=R.firstChild,L=x.firstChild,[k,F]=v(L.nextSibling);return k.nextSibling,x.$$click=()=>n(_),i(x,_,k,F),B(()=>_e(x,t()===_?"active":"")),he(),R})()),m,b),B(()=>_e(o,t()===Z?"active":"")),he(),a})(),$(()=>e.programByHour.filter(([a])=>a===t()||Z===t()).map(([a,s])=>[(()=>{var l=r(mt),d=l.firstChild,o=d.nextSibling,[c,m]=v(o.nextSibling);return c.nextSibling,i(l,a,c,m),l})(),(()=>{var l=r(ot);return i(l,()=>s.map(d=>u($t,{entry:d,get selfName(){return e.selfName},get confirmedReservations(){return e.confirmedReservations.filter(o=>o.game===d.uuid)},get tentativeReservations(){return e.tentativeReservations.filter(o=>o.gameUuid===d.uuid)},get addTentativeReservation(){return e.addTentativeReservation}}))),l})()]))]}Me(["click"]);var Re=g("<h2>Programm Samstag");function St(e){if(e.program===null)return[r(Re),u(w,{children:"Programm wird geladen ..."})];const t=He("SATURDAY",e.program);return[r(Re),u(Ge,{get selfName(){return e.selfName},programByHour:t,get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get wantsEmailUpdates(){return e.wantsEmailUpdates},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave}})]}var Ce=g("<h2>Programm Sonntag");function _t(e){if(e.program===null)return[r(Ce),u(w,{children:"Programm wird geladen ..."})];const t=He("SUNDAY",e.program);return[r(Ce),u(Ge,{get selfName(){return e.selfName},programByHour:t,get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get wantsEmailUpdates(){return e.wantsEmailUpdates},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave}})]}var ht=g("<p><strong><!$><!/> </strong>| <!$><!/>, <!$><!/> bis <!$><!/> Uhr"),ft=g("<p>Reservation für <strong>"),bt=g("<div class=content><h2>Zusammenfassung</h2><h3>Kontaktdaten</h3><ul><li><strong>Name:</strong> <!$><!/></li><li><strong>E-Mail:</strong> <!$><!/></li><li><strong>Handynummer:</strong> <!$><!/></li></ul><br><h3>Deine Reservationen</h3><!$><!/><!$><!/><!$><!/><br><h3>Updates</h3><p><em>"),yt=g("<p><em>Noch keine Reservationen getätigt."),xt=g("<h4>Unbestätigt"),Rt=g("<p>Bitte speichere deinen aktuellen Stand der Anmeldung, damit wir die folgenden Reservationen bestätigen können."),Ae=g("<h5>Samstag, 24. August 2024"),q=g("<ul role=list style=display:grid;gap:.5rem;>"),Q=g("<li>"),ke=g("<h5>Sonntag, 25. August 2024"),Ct=g("<h4>Bestätigt"),At=g("<span style=color:var(--clr-success-10);>Ja, ich möchte gerne Updates erhalten, wenn neue Spielrunden aufgeschalten werden."),kt=g("<span style=color:var(--clr-danger-10);>Nein, ich möchte keine E-Mails über neue Spielrunden erhalten.");function X(e){const{game:t,reservation:n}=e.reservation;return u(w,{get type(){return e.type??"gray"},get children(){return[(()=>{var a=r(ht),s=a.firstChild,l=s.firstChild,[d,o]=v(l.nextSibling);d.nextSibling;var c=s.nextSibling,m=c.nextSibling,[b,_]=v(m.nextSibling),T=b.nextSibling,R=T.nextSibling,[x,L]=v(R.nextSibling),k=x.nextSibling,F=k.nextSibling,[G,p]=v(F.nextSibling);return G.nextSibling,i(s,()=>t.title===null?t.system:`${t.title} (${t.system})`,d,o),i(a,()=>t.slot.day==="SATURDAY"?"Samstag":"Sonntag",b,_),i(a,()=>t.slot.start,x,L),i(a,()=>t.slot.end,G,p),a})(),(()=>{var a=r(ft),s=a.firstChild,l=s.nextSibling;return i(l,()=>n.friendsName===null?e.selfName:n.friendsName),a})()]}})}function Te(e,t){const n=[],a=[];for(const s of e){const l=t?.gameList.find(d=>d.uuid===s.gameUuid);l?.slot.day==="SATURDAY"&&n.push({reservation:s,game:l}),l?.slot.day==="SUNDAY"&&a.push({reservation:s,game:l})}return{SATURDAY:n.toSorted((s,l)=>s.game.slot.start<l.game.slot.start?-1:1),SUNDAY:a.toSorted((s,l)=>s.game.slot.start<l.game.slot.start?-1:1)}}function Tt(e){const t=Te(e.save.games.map(a=>({gameUuid:a.game,friendsName:a.spielerName})),e.program),n=Te(e.tentativeReservations,e.program);return(()=>{var a=r(bt),s=a.firstChild,l=s.nextSibling,d=l.nextSibling,o=d.firstChild,c=o.firstChild,m=c.nextSibling,b=m.nextSibling,[_,T]=v(b.nextSibling),R=o.nextSibling,x=R.firstChild,L=x.nextSibling,k=L.nextSibling,[F,G]=v(k.nextSibling),p=R.nextSibling,j=p.firstChild,te=j.nextSibling,ne=te.nextSibling,[ae,re]=v(ne.nextSibling),ie=d.nextSibling,V=ie.nextSibling,le=V.nextSibling,[z,se]=v(le.nextSibling),ue=z.nextSibling,[W,ge]=v(ue.nextSibling),de=W.nextSibling,[J,ce]=v(de.nextSibling),K=J.nextSibling,me=K.nextSibling,oe=me.nextSibling,ve=oe.firstChild;return i(o,()=>e.save.name,_,T),i(R,()=>e.save.email,F,G),i(p,()=>e.save.email,ae,re),i(a,(()=>{var E=$(()=>e.save.games.length===0&&e.tentativeReservations.length===0);return()=>E()?r(yt):null})(),z,se),i(a,(()=>{var E=$(()=>e.tentativeReservations.length>0);return()=>E()?[r(xt),r(Rt),$(()=>$(()=>n.SATURDAY.length>0)()?[r(Ae),(()=>{var y=r(q);return i(y,()=>n.SATURDAY.map(f=>(()=>{var h=r(Q);return i(h,u(X,{reservation:f,get selfName(){return e.save.name},type:"special"})),h})())),y})()]:null),$(()=>$(()=>n.SUNDAY.length>0)()?[r(ke),(()=>{var y=r(q);return i(y,()=>n.SUNDAY.map(f=>(()=>{var h=r(Q);return i(h,u(X,{reservation:f,get selfName(){return e.save.name},type:"special"})),h})())),y})()]:null)]:null})(),W,ge),i(a,(()=>{var E=$(()=>e.save.games.length>0);return()=>E()?[r(Ct),$(()=>$(()=>t.SATURDAY.length>0)()?[r(Ae),(()=>{var y=r(q);return i(y,()=>t.SATURDAY.map(f=>(()=>{var h=r(Q);return i(h,u(X,{reservation:f,get selfName(){return e.save.name},type:"special"})),h})())),y})()]:null),$(()=>$(()=>t.SUNDAY.length>0)()?[r(ke),(()=>{var y=r(q);return i(y,()=>t.SUNDAY.map(f=>(()=>{var h=r(Q);return i(h,u(X,{reservation:f,get selfName(){return e.save.name},type:"special"})),h})())),y})()]:null)]:null})(),J,ce),i(ve,(()=>{var E=$(()=>!!e.save.wantsEmailUpdates);return()=>E()?r(At):r(kt)})()),a})()}var Nt=g("<ul role=list style=display:flex;flex-wrap:wrap;column-gap:1rem;row-gap:.5rem;><li></li><li></li><li></li><li>"),Et=g("<div style=display:flex;justify-content:space-between;><div></div><div>"),wt=g("<div style=display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;gap:1rem;><div>Zuletzt gespeichert am <!$><!/></div><div style=display:flex;flex-wrap:wrap;gap:1rem;align-items:center;margin-left:auto;><p><em><small></small></em></p><!$><!/>"),Ut=g('<div style="padding-block:2rem 1rem;position:sticky;bottom:0;background-image:linear-gradient(transparent, var(--clr-3) 25%);">'),Dt=g("<div style=padding-block:1rem;>");function It(e){return(()=>{var t=r(Nt),n=t.firstChild,a=n.nextSibling,s=a.nextSibling,l=s.nextSibling;return i(n,u(H,{label:"Kontaktdaten",get kind(){return e.activeTab==="Contact"?"special":"gray"},onClick:()=>e.changeTab("Contact")})),i(a,u(H,{label:"Programm Samstag",get kind(){return e.activeTab==="Saturday"?"special":"gray"},onClick:()=>e.changeTab("Saturday")})),i(s,u(H,{label:"Program Sonntag",get kind(){return e.activeTab==="Sunday"?"special":"gray"},onClick:()=>e.changeTab("Sunday")})),i(l,u(H,{label:"Zusammenfassung",get kind(){return e.activeTab==="Summary"?"special":"gray"},onClick:()=>e.changeTab("Summary")})),t})()}function Lt(e){function t(){switch(e.activeTab){case"Saturday":e.changeTab("Contact");break;case"Sunday":e.changeTab("Saturday");break;case"Summary":e.changeTab("Sunday");break}}function n(){switch(e.activeTab){case"Contact":e.changeTab("Saturday");break;case"Saturday":e.changeTab("Sunday");break;case"Sunday":e.changeTab("Summary");break}}return(()=>{var a=r(Et),s=a.firstChild,l=s.nextSibling;return i(s,(()=>{var d=$(()=>e.activeTab!=="Contact");return()=>d()?u(H,{label:"<< Vorheriger Schritt",onClick:t}):null})()),i(l,(()=>{var d=$(()=>e.activeTab!=="Summary");return()=>d()?u(H,{label:"Nächster Schritt >>",onClick:n}):null})()),a})()}function Ft(e){const t=new Intl.DateTimeFormat("de-CH",{timeStyle:"short",dateStyle:"long"});return u(Ne,{get type(){return e.state==="HAS_CHANGES"?"success":"gray"},get children(){var n=r(wt),a=n.firstChild,s=a.firstChild,l=s.nextSibling,[d,o]=v(l.nextSibling),c=a.nextSibling,m=c.firstChild,b=m.firstChild,_=b.firstChild,T=m.nextSibling,[R,x]=v(T.nextSibling);return i(a,()=>t.format(new Date(e.lastSaved)),d,o),i(_,()=>e.state==="NO_CHANGES"?"keine Änderungen entdeckt":e.state==="HAS_CHANGES"?"ungespeicherte Änderungen entdeckt":""),i(c,u(H,{get disabled(){return e.state!=="HAS_CHANGES"},get label(){return e.state==="NO_CHANGES"?"Gespeichert.":e.state==="SAVING"?"Wird gespeichert...":"Speichern"},get kind(){return e.state==="HAS_CHANGES"?"success":"gray"},get onClick(){return e.saveCurrentState}}),R,x),n}})}function Pt(e){return[u(It,{get activeTab(){return e.activeTab},get changeTab(){return e.changeTab}}),(()=>{var t=r(Dt);return i(t,u(Ne,{get children(){return[$(()=>$(()=>e.activeTab==="Contact")()?u(We,{get save(){return e.save},get updateSave(){return e.updateSave}}):$(()=>e.activeTab==="Saturday")()?u(St,{get selfName(){return e.save.name},get program(){return e.program},get wantsEmailUpdates(){return e.save.wantsEmailUpdates},get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave}}):$(()=>e.activeTab==="Sunday")()?u(_t,{get selfName(){return e.save.name},get program(){return e.program},get wantsEmailUpdates(){return e.save.wantsEmailUpdates},get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave}}):u(Tt,{get save(){return e.save},get tentativeReservations(){return e.tentativeReservations},get program(){return e.program}})),(()=>{var n=r(Ut);return i(n,u(Ft,{get lastSaved(){return e.lastSaved},get saveCurrentState(){return e.saveCurrentState},get state(){return e.saveState}})),n})()]}})),t})(),u(Lt,{get activeTab(){return e.activeTab},get changeTab(){return e.changeTab}})]}var Ht=g("<p>Leider ist ein unerwarteter Fehler passiert. Versuche deine Anmeldung erneut zu laden. Wiederholt sich dieser Fehler, bitte kontaktiere uns sobald als möglich über das <a href=/kontakt>Kontaktformular</a>, da dies nicht passieren sollte."),Gt=g("<p>Wir konnten leider keine Anmeldung finden. Wenn du bereits eine Anmeldung begonnen hast, solltest du den korrekten Link per E-Mail erhalten haben.<br><br> Falls du noch keine Anmeldung begonnen hast, kannst du <a href=/anmeldung>hier</a> deine persönliche Anmeldung beginnen. <br><br>Für generelle Fragen oder Probleme, schreibe uns doch bitte über unser <a href=/kontatk>Kontaktformular</a>.");function P(){return{state:"ERROR",message:r(Ht)}}function pt(){const[e,t]=je({state:"LOADING"});function n(){t({state:"ERROR",message:r(Gt)})}async function a(){const c=new URL(location.href),m=c.searchParams.get("secret"),b=c.searchParams.get("showCreateMessage")==="true";if(m===null){n();return}const _=await qe(m),T=et();if(_.kind==="FAILED"){n();return}t({state:"IDLE",secret:m,showCreateMessage:b,currentSave:_.save,activeTab:"Contact",lastSaved:_.save.lastSaved,hasChanged:!1,program:null,tentativeReservations:[]}),T.then(R=>{if(R.kind==="FAILED"){n();return}t(x=>x.state!=="IDLE"&&x.state!=="SAVING"?P():{...x,program:R.program})}),c.searchParams.delete("showCreateMessage"),history.replaceState({},document.title,c),window.scrollTo({top:0})}function s(c){t(m=>m.state!=="IDLE"&&m.state!=="SAVING"?P():{...m,activeTab:c}),window.scrollTo({top:0})}function l(c,m){t(b=>b.state!=="IDLE"&&b.state!=="SAVING"?P():{...b,currentSave:{...b.currentSave,[c]:m},hasChanged:!0})}async function d(){if(e.state!=="IDLE"){t(P());return}t("state","SAVING");const c=new URL("https://elysium.gildedernacht.ch/rst24/save"),m={...e.currentSave,games:[...e.currentSave.games,...e.tentativeReservations.map(_=>_.friendsName===null?{game:_.gameUuid,self:!0,spielerName:null}:{game:_.gameUuid,self:!1,spielerName:_.friendsName})]};(await fetch(c,{method:"post",body:JSON.stringify(m),headers:{"Content-Type":"application/json"}})).ok?(t(_=>_.state!=="SAVING"?P():{..._,tentativeReservations:[]}),await a()):t(P())}function o(c){t(m=>m.state!=="IDLE"&&m.state!=="SAVING"?P():{...m,hasChanged:!0,tentativeReservations:[...m.tentativeReservations,c]})}return{store:e,actions:{changeTab:s,updateSave:l,saveCurrentState:d,onFailed:n,initMeineAnmeldung:a,addTentativeReservation:o}}}var Mt=g("<code><pre>"),Bt=g("<p>Deine Anmeldung wird geladen."),Se=g("<br>");function jt(){const{store:e,actions:t}=pt();return Oe(async()=>{await t.initMeineAnmeldung()}),[$(()=>$(()=>e.state==="ERROR")()?u(w,{type:"danger",get children(){return e.message}}):$(()=>e.state==="LOADING")()?u(w,{get children(){return r(Bt)}}):[u(ee,{get when(){return e.showCreateMessage},get children(){return[u(w,{type:"success",get children(){return["Deine Anmeldung wurde erfolgreich gestartet.",r(Se),r(Se),"Wir haben eine E-Mail an deine Adresse gesendet. In dieser E-Mail findest du einen persönlichen Link, um deine Anmeldung bis kurz vor dem Anlass anzupassen."]}}),r(Se)]}}),u(Pt,{get activeTab(){return e.activeTab},get changeTab(){return t.changeTab},get save(){return e.currentSave},get updateSave(){return t.updateSave},get lastSaved(){return e.lastSaved},get saveCurrentState(){return t.saveCurrentState},get saveState(){return e.state==="SAVING"?"SAVING":e.hasChanged?"HAS_CHANGES":"NO_CHANGES"},get program(){return e.program},get confirmedReservations(){return e.currentSave.games},get tentativeReservations(){return e.tentativeReservations},get addTentativeReservation(){return t.addTentativeReservation}})]),(()=>{var n=r(Mt),a=n.firstChild;return i(a,()=>JSON.stringify(e,null,2)),n})()]}export{jt as MeineAnmeldung};
