import{g as a,c as s,i as o,S as q,t as c,a as $,b as p,s as Ke,e as ce,d as Ze,f as Je,j as ge,r as z,k as m,l as Q,h as j,M as V,n as me,E as qe}from"./web.DaGPATpz.js";import{I as ve,B as w,a as Qe,S as _e,b as B}from"./Box.ColxJqt4.js";import{e as Se,a as W,o as k,s as f,b as Y,n as x,l as be,d as Xe,u as Re,f as ye,c as et}from"./index.CzBVzVAw.js";var tt=c("<h2>Kontaktdaten"),nt=c("<div class=content><small>Deine persönlichen Daten werden ausschliesslich verwendet, um dich über das Programm der Luzerner Rollenspieltage 2024 zu informieren. Nach dem Event werden diese gelöscht."),ae=c("<br>"),ie=c("<div style=margin-block:.5rem;>");function rt(e){let n;return[a(tt),a(nt),a(ae),s(ve,{label:"Name",name:"name",get value(){return e.save.name},onValueUpdate:t=>e.updateSave("name",t)}),s(q,{get when(){return e.save.name.trim().length===0},get children(){var t=a(ie);return o(t,s(w,{type:"danger",children:"Dies ist ein Pflichtfeld."})),t}}),a(ae),s(Qe,{label:"E-Mail",name:"email",type:"email",get value(){return e.save.email},onValueUpdate:t=>e.updateSave("email",t),ref(t){var u=n;typeof u=="function"?u(t):n=t}}),s(q,{get when(){return e.save.email.trim().length===0},get children(){var t=a(ie);return o(t,s(w,{type:"danger",children:"Dies ist ein Pflichtfeld."})),t}}),s(q,{get when(){return e.save.email.length>0&&n.validity.typeMismatch},get children(){var t=a(ie);return o(t,s(w,{type:"danger",children:"Die Eingabe scheint keine gültige E-Mail-Adresse zu sein."})),t}}),a(ae),s(ve,{label:"Handynummer",name:"tel",type:"tel",get value(){return e.save.handynummer},required:!1,onValueUpdate:t=>e.updateSave("handynummer",t)})]}const ke=Se(["SATURDAY","SUNDAY"]);W(k({uuid:f(),description:Y(f()),title:Y(f()),system:f(),master:k({first:f(),last:Y(f())}),playerCount:k({min:x(),max:x()}),slot:k({day:ke,start:x(),end:x()})}));const xe=Se(["INITIALIZED","IN_PROGRESS","CONFIRMED","CONFIRMED_W_INVALID_CHANGES","CONFIRMED_W_VALID_CHANGES","RECONFIRMED"]),Ce=k({game:f(),self:be(!0),spielerName:Xe()}),Te=k({game:f(),self:be(!1),spielerName:f()}),at=Re([Ce.extend({id:x()}),Te.extend({id:x()})]),it=Re([Ce,Te]),lt=k({registrationId:x(),progress:xe,name:f(),email:f(),handynummer:f(),wantsEmailUpdates:ye(),games:W(at),lastSaved:f()});k({registrationId:x(),progress:xe,name:f(),email:f(),handynummer:f(),wantsEmailUpdates:ye(),games:W(it),lastSaved:f()});async function st(e){const n=new URL("https://elysium.gildedernacht.ch/rst24/load");n.searchParams.append("secret",e);const t=await fetch(n);if(!t.ok)return{kind:"FAILED"};const u=await t.json(),l=lt.safeParse(u);return l.success?{kind:"SUCCESS",save:l.data}:{kind:"FAILED"}}const dt=k({uuid:f(),title:Y(f()),system:f(),description:Y(f()),playerCount:k({min:x(),max:x()}),master:k({first:f(),last:Y(f())}),slot:k({day:ke,start:x(),end:x()})}),ut=k({id:x(),gameId:f()});async function gt(){const e=new URL("https://elysium.gildedernacht.ch/rst24/program"),n=new URL("https://elysium.gildedernacht.ch/rst24/reserved"),[t,u]=await Promise.all([fetch(e),fetch(n)]);if(!t.ok)return{kind:"FAILED"};if(!u.ok)return{kind:"FAILED"};const l=await t.json(),i=await u.json(),r=W(dt).safeParse(l);if(!r.success)return{kind:"FAILED"};const d=W(ut).safeParse(i);return d.success?{kind:"SUCCESS",program:{gameList:r.data,reservedList:d.data}}:{kind:"FAILED"}}function Ae(e,n){const u=n.gameList.filter(i=>i.slot.day===e).map(i=>{const r=i.uuid,d=n.reservedList.filter(g=>g.gameId===r);return{...i,reservedIds:d.map(g=>g.id)}});let l={};for(const i of u){const{start:r}=i.slot,d=l[r]??[];d.push(i),l[r]=d}return Object.entries(l)}var ot=c("<label class=input-checkbox><input type=checkbox><!$><!/>");function ct(e){return(()=>{var n=a(ot),t=n.firstChild,u=t.nextSibling,[l,i]=$(u.nextSibling);return t.addEventListener("change",r=>e.onValueUpdate(r.target.checked)),o(n,()=>e.label,l,i),p(()=>Ke(t,"name",e.name)),p(()=>ce(t,"value",e.value)),p(()=>ce(t,"checked",e.checked)),n})()}var mt=c("<li><h1 class=event-title></h1><div class=event-details><div class=event-tags><strong>Zeit:</strong> <!$><!/> - <!$><!/> Uhr</div><div class=event-tags><strong>Spielleitung:</strong> <!$><!/> <!$><!/></div><div class=event-tags><strong>Freie Plätze:</strong> <!$><!/></div><!$><!/></div><div class=event-description><!$><!/><!$><!/></div><!$><!/>"),vt=c("<span>Es hat noch <strong><!$><!/> Plätze</strong> frei."),$t=c("<span>Es hat noch <strong><!$><!/> Platz</strong> frei."),ht=c("<div class=event-tags style=display:block;><em>(Du hast dich bereits für eine Spielrunde eingetragen, die diese Spielrunde zeitlich überschneidet.)"),ft=c('<div class="event-description content"><p><strong>Beschreibung:</strong><br><!$><!/>'),_t=c("<div><p><strong>Deine Reservationen</strong></p><ul>"),St=c("<li style=font-size:0.83rem;>"),bt=c("<s>"),$e=c('<span title="ungespeicherte Änderung"> *'),Rt=c('<a href=javascript:; style=border:none; title="Reservation löschen"><i class="fa-duotone fa-circle-xmark">'),yt=c("<ul role=list class=event-links><li><a class=event-link href=javascript:;>+ Platz für mich reservieren"),kt=c("<ul role=list class=event-links><li><a class=event-link href=javascript:;>+ Platz für Begleitung reservieren"),xt=c(`<style>
          .event-filters .active {
            color: var(--clr-success-10) !important;
          }
        `),Ct=c("<div class=content><small>Auf dieser Seite kannst du dich und deine Freunde für Spielrunden einschreiben, solange es freie Plätze hat."),he=c("<br>"),Tt=c("<div class=event-filters><h2>Filter</h2><ul role=list><li><a href=javascript:;>Alle</a></li><!$><!/>"),At=c("<li><a href=javascript:;><!$><!/> Uhr"),Et=c("<h3 style=margin-block:1rem;>Start <!$><!/> Uhr"),Dt=c("<ul class=event-list role=list>");const wt=1;function J(e,n){const{from:t,to:u}=n;return t<=e&&e<=u}function Nt(e,n){const{from:t,to:u}=e,{from:l,to:i}=n;return J(t,n)||J(u,n)||J(l,e)||J(i,e)}function Ut(e){function n(){return[...e.confirmedReservations.map(l=>({name:l.spielerName??e.selfName,confirmed:!0,gameUuid:e.entry.uuid,reservationId:l.id,markedForDeletion:e.markedForDeletionReservations.includes(l.id)})),...e.tentativeReservations.map(l=>({name:l.friendsName??e.selfName,confirmed:!1,gameUuid:e.entry.uuid,markedForDeletion:!1}))]}function t(){const l=e.confirmedReservations.map(r=>r.id),i=e.entry.reservedIds.filter(r=>!l.includes(r));return e.entry.playerCount.max-wt-i.length-n().filter(r=>!r.markedForDeletion).length}function u(){const{start:l,end:i}=e.entry.slot;return e.reservedTimeRanges.filter(d=>Nt({from:l,to:i},d.range)).filter(d=>d.gameUuid!==e.entry.uuid).length===0}return(()=>{var l=a(mt),i=l.firstChild,r=i.nextSibling,d=r.firstChild,g=d.firstChild,v=g.nextSibling,S=v.nextSibling,[h,N]=$(S.nextSibling),R=h.nextSibling,U=R.nextSibling,[F,E]=$(U.nextSibling);F.nextSibling;var D=d.nextSibling,I=D.firstChild,H=I.nextSibling,X=H.nextSibling,[K,ee]=$(X.nextSibling),te=K.nextSibling,ne=te.nextSibling,[we,Ne]=$(ne.nextSibling),re=D.nextSibling,Ue=re.firstChild,Fe=Ue.nextSibling,Ie=Fe.nextSibling,[Pe,He]=$(Ie.nextSibling),Le=re.nextSibling,[Be,Me]=$(Le.nextSibling),Z=r.nextSibling,Oe=Z.firstChild,[oe,Ge]=$(Oe.nextSibling),pe=oe.nextSibling,[Ye,ze]=$(pe.nextSibling),je=Z.nextSibling,[Ve,We]=$(je.nextSibling);return o(i,()=>e.entry.title===null?e.entry.system:`${e.entry.title} (${e.entry.system})`),o(d,()=>e.entry.slot.start,h,N),o(d,()=>e.entry.slot.end,F,E),o(D,()=>e.entry.master.first,K,ee),o(D,()=>e.entry.master.last,we,Ne),o(re,(()=>{var A=m(()=>t()>1);return()=>A()?(()=>{var C=a(vt),_=C.firstChild,T=_.nextSibling,b=T.firstChild,[y,L]=$(b.nextSibling);return y.nextSibling,o(T,t,y,L),C})():(()=>{var C=m(()=>t()===1);return()=>C()?(()=>{var _=a($t),T=_.firstChild,b=T.nextSibling,y=b.firstChild,[L,P]=$(y.nextSibling);return L.nextSibling,o(b,t,L,P),_})():"Diese Spielrunde ist bereits voll besetzt."})()})(),Pe,He),o(r,(()=>{var A=m(()=>t()>0&&!u());return()=>A()?a(ht):null})(),Be,Me),o(Z,(()=>{var A=m(()=>e.entry.description!==null&&e.entry.description.trim().length>0);return()=>A()?(()=>{var C=a(ft),_=C.firstChild,T=_.firstChild,b=T.nextSibling,y=b.nextSibling,[L,P]=$(y.nextSibling);return o(_,()=>e.entry.description,L,P),C})():null})(),oe,Ge),o(Z,(()=>{var A=m(()=>n().length>0);return()=>A()?(()=>{var C=a(_t),_=C.firstChild,T=_.nextSibling;return o(T,()=>n().map(b=>(()=>{var y=a(St);return o(y,(()=>{var L=m(()=>!!b.markedForDeletion);return()=>L()?[(()=>{var P=a(bt);return o(P,()=>b.name),P})(),a($e)]:[m(()=>b.name),m(()=>m(()=>!!b.confirmed)()?null:a($e)),(()=>{var P=a(Rt);return P.$$click=()=>e.deleteReservation(b),z(),P})()]})()),y})())),C})():null})(),Ye,ze),o(l,(()=>{var A=m(()=>!!(t()>0&&u()));return()=>A()?(()=>{var C=m(()=>n().filter(_=>!_.markedForDeletion).length===0);return()=>C()?(()=>{var _=a(yt),T=_.firstChild,b=T.firstChild;return b.$$click=()=>e.addTentativeReservation({gameUuid:e.entry.uuid,friendsName:null}),z(),_})():(()=>{var _=a(kt),T=_.firstChild,b=T.firstChild;return b.$$click=()=>{const y=prompt("Bitte teile uns mit, wie deine Begleitung heisst:");y!==null&&y.trim().length>0&&e.addTentativeReservation({gameUuid:e.entry.uuid,friendsName:y})},z(),_})()})():null})(),Ve,We),p(()=>ge(l,`event-entry ${n().filter(A=>!A.markedForDeletion).length>0?"success":t()>0&&u()?"special":"gray"}`)),l})()}function Ft(e){const n=e.confirmedReservations.filter(i=>!e.markedForDeletionReservations.includes(i.id)).map(i=>i.game);n.push(...e.tentativeReservations.map(i=>i.gameUuid));const t=new Set(n);return e.programByHour.flatMap(([i,r])=>r).filter(i=>t.has(i.uuid)).map(i=>({range:{from:i.slot.start,to:i.slot.end},gameUuid:i.uuid}))}function Ee(e){const[n,t]=Je([]);function u(i){t(r=>r.includes(i)?r.filter(d=>d!==i):[...r,i])}const l=()=>Ft({programByHour:e.programByHour,confirmedReservations:e.confirmedReservations,tentativeReservations:e.tentativeReservations,markedForDeletionReservations:e.markedForDeletionReservations});return[a(xt),a(Ct),a(he),s(ct,{get checked(){return e.wantsEmailUpdates},onValueUpdate:i=>e.updateSave("wantsEmailUpdates",i),label:"Ja, ich möchte gerne Updates erhalten, wenn neue Spielrunden aufgeschalten werden.",name:"wantsUpdates",value:"true"}),a(he),(()=>{var i=a(Tt),r=i.firstChild,d=r.nextSibling,g=d.firstChild,v=g.firstChild,S=g.nextSibling,[h,N]=$(S.nextSibling);return v.$$click=()=>t([]),o(d,()=>e.programByHour.map(([R,U])=>(()=>{var F=a(At),E=F.firstChild,D=E.firstChild,[I,H]=$(D.nextSibling);return I.nextSibling,E.$$click=()=>u(R),o(E,R,I,H),p(()=>ge(E,n().includes(R)?"active":"")),z(),F})()),h,N),p(()=>ge(v,n().length===0?"active":"")),z(),i})(),m(()=>e.programByHour.filter(([i])=>n().includes(i)||n().length===0).map(([i,r])=>[(()=>{var d=a(Et),g=d.firstChild,v=g.nextSibling,[S,h]=$(v.nextSibling);return S.nextSibling,o(d,i,S,h),d})(),(()=>{var d=a(Dt);return o(d,()=>r.map(g=>s(Ut,{entry:g,get selfName(){return e.selfName},get confirmedReservations(){return e.confirmedReservations.filter(v=>v.game===g.uuid)},get tentativeReservations(){return e.tentativeReservations.filter(v=>v.gameUuid===g.uuid)},get markedForDeletionReservations(){return e.markedForDeletionReservations},get reservedTimeRanges(){return l()},get addTentativeReservation(){return e.addTentativeReservation},get deleteReservation(){return e.deleteReservation}}))),d})()]))]}Ze(["click"]);function It(e){const n=Ae("SATURDAY",e.program);return s(Ee,{get selfName(){return e.selfName},programByHour:n,get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get markedForDeletionReservations(){return e.markedForDeletionReservations},get wantsEmailUpdates(){return e.wantsEmailUpdates},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave},get deleteReservation(){return e.deleteReservation}})}function Pt(e){const n=Ae("SUNDAY",e.program);return s(Ee,{get selfName(){return e.selfName},programByHour:n,get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get markedForDeletionReservations(){return e.markedForDeletionReservations},get wantsEmailUpdates(){return e.wantsEmailUpdates},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave},get deleteReservation(){return e.deleteReservation}})}var Ht=c("<p><strong><!$><!/> </strong>| <!$><!/>, <!$><!/> bis <!$><!/> Uhr"),Lt=c("<p>Reservation für <strong>"),Bt=c("<h3>Kontaktdaten"),Mt=c("<ul><li><strong>Name:</strong> <!$><!/></li><li><strong>E-Mail:</strong> <!$><!/></li><li><strong>Handynummer:</strong> <!$><!/>"),fe=c("<br>"),Ot=c("<h3>Deine Reservationen"),Gt=c("<h3>Updates"),pt=c("<p><em>"),Yt=c("<p><em>Noch keine Reservationen getätigt."),zt=c("<h4>Unbestätigt"),jt=c("<p>Bitte speichere deinen aktuellen Stand der Anmeldung, damit wir die folgenden Reservationen bestätigen können."),le=c("<h5>Samstag, 24. August 2024"),M=c("<ul role=list style=display:grid;gap:.5rem;>"),O=c("<li>"),se=c("<h5>Sonntag, 25. August 2024"),Vt=c("<h4>Reservationen, die du entfernen möchtest"),Wt=c("<p>Bitte speichere deinen aktuellen Stand der Anmeldung, damit wir die folgenden Reservationen entfernen können."),Kt=c("<h4>Bestätigt"),Zt=c("<span style=color:var(--clr-success-10);>Ja, ich möchte gerne Updates erhalten, wenn neue Spielrunden aufgeschalten werden."),Jt=c("<span style=color:var(--clr-danger-10);>Nein, ich möchte keine E-Mails über neue Spielrunden erhalten.");function G(e){const{game:n,reservation:t}=e.reservation;return s(w,{get type(){return e.type??"gray"},get children(){return[(()=>{var u=a(Ht),l=u.firstChild,i=l.firstChild,[r,d]=$(i.nextSibling);r.nextSibling;var g=l.nextSibling,v=g.nextSibling,[S,h]=$(v.nextSibling),N=S.nextSibling,R=N.nextSibling,[U,F]=$(R.nextSibling),E=U.nextSibling,D=E.nextSibling,[I,H]=$(D.nextSibling);return I.nextSibling,o(l,()=>n.title===null?n.system:`${n.title} (${n.system})`,r,d),o(u,()=>n.slot.day==="SATURDAY"?"Samstag":"Sonntag",S,h),o(u,()=>n.slot.start,U,F),o(u,()=>n.slot.end,I,H),u})(),(()=>{var u=a(Lt),l=u.firstChild,i=l.nextSibling;return o(i,()=>t.friendsName===null?e.selfName:t.friendsName),u})()]}})}function de(e,n){const t=[],u=[];for(const l of e){const i=n.gameList.find(r=>r.uuid===l.gameUuid);i?.slot.day==="SATURDAY"&&t.push({reservation:l,game:i}),i?.slot.day==="SUNDAY"&&u.push({reservation:l,game:i})}return{SATURDAY:t.toSorted((l,i)=>l.game.slot.start<i.game.slot.start?-1:1),SUNDAY:u.toSorted((l,i)=>l.game.slot.start<i.game.slot.start?-1:1)}}function qt(e){const{con:n,del:t}=e.save.games.reduce((r,d)=>e.markedForDeletionReservations.includes(d.id)?{...r,del:[...r.del,d]}:{...r,con:[...r.con,d]},{con:[],del:[]}),u=de(n.map(r=>({gameUuid:r.game,friendsName:r.spielerName})),e.program),l=de(t.map(r=>({gameUuid:r.game,friendsName:r.spielerName})),e.program),i=de(e.tentativeReservations,e.program);return[a(Bt),(()=>{var r=a(Mt),d=r.firstChild,g=d.firstChild,v=g.nextSibling,S=v.nextSibling,[h,N]=$(S.nextSibling),R=d.nextSibling,U=R.firstChild,F=U.nextSibling,E=F.nextSibling,[D,I]=$(E.nextSibling),H=R.nextSibling,X=H.firstChild,K=X.nextSibling,ee=K.nextSibling,[te,ne]=$(ee.nextSibling);return o(d,()=>e.save.name,h,N),o(R,()=>e.save.email,D,I),o(H,()=>e.save.handynummer,te,ne),r})(),a(fe),a(Ot),m(()=>m(()=>e.save.games.length===0&&e.tentativeReservations.length===0)()?a(Yt):null),m(()=>m(()=>e.tentativeReservations.length>0)()?[a(zt),a(jt),m(()=>m(()=>i.SATURDAY.length>0)()?[a(le),(()=>{var r=a(M);return o(r,()=>i.SATURDAY.map(d=>(()=>{var g=a(O);return o(g,s(G,{reservation:d,get selfName(){return e.save.name},type:"special"})),g})())),r})()]:null),m(()=>m(()=>i.SUNDAY.length>0)()?[a(se),(()=>{var r=a(M);return o(r,()=>i.SUNDAY.map(d=>(()=>{var g=a(O);return o(g,s(G,{reservation:d,get selfName(){return e.save.name},type:"special"})),g})())),r})()]:null)]:null),m(()=>m(()=>t.length>0)()?[a(Vt),a(Wt),m(()=>m(()=>l.SATURDAY.length>0)()?[a(le),(()=>{var r=a(M);return o(r,()=>l.SATURDAY.map(d=>(()=>{var g=a(O);return o(g,s(G,{reservation:d,get selfName(){return e.save.name},type:"danger"})),g})())),r})()]:null),m(()=>m(()=>l.SUNDAY.length>0)()?[a(se),(()=>{var r=a(M);return o(r,()=>l.SUNDAY.map(d=>(()=>{var g=a(O);return o(g,s(G,{reservation:d,get selfName(){return e.save.name},type:"danger"})),g})())),r})()]:null)]:null),m(()=>m(()=>n.length>0)()?[a(Kt),m(()=>m(()=>u.SATURDAY.length>0)()?[a(le),(()=>{var r=a(M);return o(r,()=>u.SATURDAY.map(d=>(()=>{var g=a(O);return o(g,s(G,{reservation:d,get selfName(){return e.save.name},type:"success"})),g})())),r})()]:null),m(()=>m(()=>u.SUNDAY.length>0)()?[a(se),(()=>{var r=a(M);return o(r,()=>u.SUNDAY.map(d=>(()=>{var g=a(O);return o(g,s(G,{reservation:d,get selfName(){return e.save.name},type:"success"})),g})())),r})()]:null)]:null),a(fe),a(Gt),(()=>{var r=a(pt),d=r.firstChild;return o(d,(()=>{var g=m(()=>!!e.save.wantsEmailUpdates);return()=>g()?a(Zt):a(Jt)})()),r})()]}var Qt=c("<ul role=list style=display:flex;flex-wrap:wrap;column-gap:1rem;row-gap:.5rem;><li></li><li></li><li></li><li>"),Xt=c("<div style=display:flex;justify-content:space-between;><div></div><div>"),en=c("<div style=display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;gap:1rem;><div>Zuletzt gespeichert am <!$><!/></div><div style=display:flex;flex-wrap:wrap;gap:1rem;align-items:center;margin-left:auto;><p><em><small></small></em></p><!$><!/>"),tn=c('<div style="padding-block:2rem 1rem;position:sticky;bottom:0;background-image:linear-gradient(transparent, var(--clr-3) 25%);">'),nn=c("<div style=padding-block:1rem;>"),rn=c("<h2>Programm Samstag"),an=c("<h2>Programm Sonntag"),ln=c("<div class=content><h2>Zusammenfassung</h2><small>Hier hast du die komplette Übersicht über alle deine Eingaben. Du kannst bis am <strong>Freitag, 23. August 2024</strong> zurückkommen und deine Kontaktdaten und Reservationen anpassen.</small><!$><!/>");function sn(e){return(()=>{var n=a(Qt),t=n.firstChild,u=t.nextSibling,l=u.nextSibling,i=l.nextSibling;return o(t,s(B,{label:"Kontaktdaten",get kind(){return e.activeTab==="Contact"?"special":"gray"},onClick:()=>e.changeTab("Contact")})),o(u,s(B,{label:"Programm Samstag",get kind(){return e.activeTab==="Saturday"?"special":"gray"},onClick:()=>e.changeTab("Saturday")})),o(l,s(B,{label:"Program Sonntag",get kind(){return e.activeTab==="Sunday"?"special":"gray"},onClick:()=>e.changeTab("Sunday")})),o(i,s(B,{label:"Zusammenfassung",get kind(){return e.activeTab==="Summary"?"special":"gray"},onClick:()=>e.changeTab("Summary")})),n})()}function dn(e){function n(){switch(e.activeTab){case"Saturday":e.changeTab("Contact");break;case"Sunday":e.changeTab("Saturday");break;case"Summary":e.changeTab("Sunday");break}}function t(){switch(e.activeTab){case"Contact":e.changeTab("Saturday");break;case"Saturday":e.changeTab("Sunday");break;case"Sunday":e.changeTab("Summary");break}}return(()=>{var u=a(Xt),l=u.firstChild,i=l.nextSibling;return o(l,(()=>{var r=m(()=>e.activeTab!=="Contact");return()=>r()?s(B,{label:"<< Vorheriger Schritt",onClick:n}):null})()),o(i,(()=>{var r=m(()=>e.activeTab!=="Summary");return()=>r()?s(B,{label:"Nächster Schritt >>",onClick:t}):null})()),u})()}function un(e){const n=new Intl.DateTimeFormat("de-CH",{timeStyle:"short",dateStyle:"long"});return s(_e,{get type(){return e.state==="HAS_CHANGES"?"success":"gray"},get children(){var t=a(en),u=t.firstChild,l=u.firstChild,i=l.nextSibling,[r,d]=$(i.nextSibling),g=u.nextSibling,v=g.firstChild,S=v.firstChild,h=S.firstChild,N=v.nextSibling,[R,U]=$(N.nextSibling);return o(u,()=>n.format(new Date(e.lastSaved)),r,d),o(h,()=>e.state==="NO_CHANGES"?"keine Änderungen entdeckt":e.state==="HAS_CHANGES"?"ungespeicherte Änderungen entdeckt":""),o(g,s(B,{get disabled(){return e.state!=="HAS_CHANGES"},get label(){return e.state==="NO_CHANGES"?"Gespeichert.":e.state==="SAVING"?"Wird gespeichert...":"Speichern"},get kind(){return e.state==="HAS_CHANGES"?"success":"gray"},get onClick(){return e.saveCurrentState}}),R,U),t}})}function gn(e){return[s(sn,{get activeTab(){return e.activeTab},get changeTab(){return e.changeTab}}),(()=>{var n=a(nn);return o(n,s(_e,{get children(){return[m(()=>m(()=>e.activeTab==="Contact")()?s(rt,{get save(){return e.save},get updateSave(){return e.updateSave}}):m(()=>e.activeTab==="Saturday")()?[a(rn),s(Q,{get fallback(){return s(w,{children:"Programm wird geladen ..."})},get children(){return s(j,{get children(){return s(V,{get when(){return e.programResource()},children:t=>s(It,{get selfName(){return e.save.name},get program(){return t()},get wantsEmailUpdates(){return e.save.wantsEmailUpdates},get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get markedForDeletionReservations(){return e.markedForDeletionReservations},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave},get deleteReservation(){return e.deleteReservation}})})}})}})]:m(()=>e.activeTab==="Sunday")()?[a(an),s(Q,{get fallback(){return s(w,{children:"Programm wird geladen ..."})},get children(){return s(j,{get children(){return s(V,{get when(){return e.programResource()},children:t=>s(Pt,{get selfName(){return e.save.name},get program(){return t()},get wantsEmailUpdates(){return e.save.wantsEmailUpdates},get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get markedForDeletionReservations(){return e.markedForDeletionReservations},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave},get deleteReservation(){return e.deleteReservation}})})}})}})]:(()=>{var t=a(ln),u=t.firstChild,l=u.nextSibling,i=l.nextSibling,[r,d]=$(i.nextSibling);return o(t,s(Q,{get fallback(){return s(w,{children:"Zusammenfassung wird geladen ..."})},get children(){return s(j,{get children(){return s(V,{get when(){return e.programResource()},children:g=>s(qt,{get save(){return e.save},get tentativeReservations(){return e.tentativeReservations},get program(){return g()},get markedForDeletionReservations(){return e.markedForDeletionReservations}})})}})}}),r,d),t})()),(()=>{var t=a(tn);return o(t,s(un,{get lastSaved(){return e.lastSaved},get saveCurrentState(){return e.saveCurrentState},get state(){return e.saveState}})),t})()]}})),n})(),s(dn,{get activeTab(){return e.activeTab},get changeTab(){return e.changeTab}})]}function on(){const e=new URL(location.href),n=e.searchParams.get("secret"),t=e.searchParams.get("showCreateMessage")==="true";return{secret:n,showCreateMessage:t}}async function De(e){if(e.secret===null)throw Error("SECRET_ERROR");const n=await st(e.secret);if(n.kind==="FAILED")throw Error("SECRET_ERROR");return{state:"IDLE",secret:e.secret,showCreateMessage:e.showCreateMessage,currentSave:n.save,activeTab:"Contact",lastSaved:n.save.lastSaved,hasChanged:!1,tentativeReservations:[],markedForDeletionReservations:[]}}async function cn(){const e=await gt();if(e.kind==="FAILED")throw Error("PROGRAM_ERROR");return e.program}function mn(e){const[n,t]=et(e);function u(g){t("activeTab",g),window.scrollTo({top:0})}function l(g,v){t("hasChanged",!0),t("currentSave",g,v)}async function i(){if(n.state!=="IDLE")throw Error("ASSERTION_ERROR");t("state","SAVING");const g=new URL("https://elysium.gildedernacht.ch/rst24/save"),v={...n.currentSave,games:[...n.currentSave.games.filter(h=>!n.markedForDeletionReservations.includes(h.id)),...n.tentativeReservations.map(h=>h.friendsName===null?{game:h.gameUuid,self:!0,spielerName:null}:{game:h.gameUuid,self:!1,spielerName:h.friendsName})]};if((await fetch(g,{method:"post",body:JSON.stringify(v),headers:{"Content-Type":"application/json"}})).ok){const h=await De({secret:n.secret,showCreateMessage:!1});t({...h,activeTab:n.activeTab})}else throw Error("SAVE_ERROR")}function r(g){t("hasChanged",!0),t("tentativeReservations",v=>[...v,g])}function d(g){if(t("hasChanged",!0),g.confirmed)t("markedForDeletionReservations",v=>[...v,g.reservationId]);else{const v=n.currentSave.name;t("tentativeReservations",S=>S.filter(h=>h.gameUuid!==g.gameUuid?!0:h.friendsName===g.name?!1:g.name!==v))}}return{state:n,actions:{changeTab:u,updateSave:l,saveCurrentState:i,addTentativeReservation:r,deleteReservation:d}}}var ue=c("<br>"),vn=c("<strong>Freitag, 23. August 2024"),$n=c("<p>Wir konnten leider keine Anmeldung finden. Wenn du bereits eine Anmeldung begonnen hast, solltest du den korrekten Link per E-Mail erhalten haben.<br><br> Falls du noch keine Anmeldung begonnen hast, kannst du <a href=/anmeldung>hier</a> deine persönliche Anmeldung beginnen. <br><br>Für generelle Fragen oder Probleme, schreibe uns doch bitte über unser <a href=/kontatk>Kontaktformular</a>."),hn=c("<p>Leider ist ein unerwarteter Fehler passiert. Versuche deine Anmeldung erneut zu laden. Wiederholt sich dieser Fehler, bitte kontaktiere uns sobald als möglich über das <a href=/kontakt>Kontaktformular</a>, da dies nicht passieren sollte."),fn=c("<p>Deine Anmeldung wird geladen...");function _n(e){const{state:n,actions:t}=mn(e.state);return[s(q,{get when(){return n.showCreateMessage},get children(){return[s(w,{type:"success",get children(){return["Deine Anmeldung wurde erfolgreich gestartet.",a(ue),a(ue),"Wir haben eine E-Mail an deine Adresse gesendet. In dieser E-Mail findest du einen persönlichen Link, um deine Anmeldung bis am"," ",a(vn)," anzupassen."]}}),a(ue)]}}),s(gn,{get activeTab(){return n.activeTab},get changeTab(){return t.changeTab},get save(){return n.currentSave},get updateSave(){return t.updateSave},get lastSaved(){return n.lastSaved},get saveCurrentState(){return t.saveCurrentState},get saveState(){return n.state==="SAVING"?"SAVING":n.hasChanged?"HAS_CHANGES":"NO_CHANGES"},get programResource(){return e.programResource},get confirmedReservations(){return n.currentSave.games},get tentativeReservations(){return n.tentativeReservations},get addTentativeReservation(){return t.addTentativeReservation},get deleteReservation(){return t.deleteReservation},get markedForDeletionReservations(){return n.markedForDeletionReservations}})]}function yn(){const e=on(),[n]=me(()=>De(e)),[t]=me(()=>cn());return s(qe,{fallback:u=>s(w,{type:"danger",get children(){return s(j,{get fallback(){return a(hn)},get children(){return s(V,{get when(){return u.message==="SECRET_ERROR"},get children(){return a($n)}})}})}}),get children(){return s(Q,{get fallback(){return s(w,{get children(){return a(fn)}})},get children(){return s(j,{get children(){return s(V,{get when(){return n()},children:u=>s(_n,{get state(){return u()},programResource:t})})}})}})}})}export{yn as MeineAnmeldung};
